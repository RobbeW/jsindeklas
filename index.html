<!--Auteur: Robbe Wulgaert / aiindeklas.be-->
<!-- Copyright 2025 - Gebruik vrij voor educatie -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <title>JavaScript in de Klas</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/lib/codemirror.min.css">
  <style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background: #fff;
  color: #23272e;
  font-family: 'Roboto', Arial, Helvetica, sans-serif;
  min-height: 100vh;
  transition: background 0.25s, color 0.25s;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  transition: background 0.25s, color 0.25s;
}

.topbar,
.editor-pane,
.canvas-pane,
.main-layout,
.modal-content,
.modal,
.help-content,
.toolbar button,
.exercise-btn,
.menu-tab,
#code-editor,
#console-output,
.course-menu,
.help-modal,
.swatch,
.label,
.close-menu,
.modal-content input[type="text"],
#modal-ok,
.run-btn,
#export-pdf,
#toggle-theme,
.exercise-btn.current,
.exercise-btn.completed
{
  transition: background 0.25s, color 0.25s, border-color 0.25s, box-shadow 0.25s;
}

.topbar {
  width: 100%;
  box-sizing: border-box;
  background: #fff;
  border-bottom: 1.5px solid #eee;
  padding: 0.8rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.main-layout {
  display: flex;
  flex-direction: row;
  width: 100vw;
  height: 100vh;
  min-height: 0; /* Ensure flex children can shrink */
  overflow: hidden;
  background: #f3f5f8;
}

.editor-pane {
  flex: 0 0 420px;  /* Start at 420px, grows only if JS changes it */
  min-width: 220px;
  max-width: none;
  background: #f7f8fa;
  border-radius: 18px 0 0 18px;
  padding: 1.5rem;
  box-sizing: border-box;
  transition: background 0.2s;
  overflow: auto;
}

.canvas-pane {
  flex: 1 1 0;
  min-width: 220px;
  background: #f7f8fa;
  border-radius: 0 18px 18px 0;
  padding: 1.5rem;
  box-sizing: border-box;
  overflow: auto;
}



#turtlecanvas, #imagecanvas {
  width: 100%;
  max-width: 900px;
  height: auto;
}


.editor-label,
.console-label,
.canvas-label {
  font-weight: 900;
  font-size: 1.14em;
  color: #5200FF;
  margin-bottom: 0.5rem;
}

#code-editor {
  height: 320px;
  border-radius: 8px;
  overflow: hidden;
  border: 1.5px solid #5200FF;
  background: #fff;
}

.run-btn {
  background: #3dffd0;
  color: #23272e;
  border: none;
  border-radius: 6px;
  padding: 0.5rem 1rem;
  font-size: 1.1em;
  font-weight: 700;
  cursor: pointer;
  margin-bottom: 0.7rem;
  width: 140px;
  align-self: flex-start;
}

.run-btn:hover {
  background: #5ffff0;
}

#console-output {
  background: #161820;
  color: #fff;
  min-height: 60px;
  border-radius: 8px;
  padding: 0.65rem 1rem;
  font-family: monospace;
  font-size: 1em;
  white-space: pre-line;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}

.canvas-header {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

#coords {
  font-family: monospace;
  color: #23272e;
  font-size: 1em;
}

#turtlecanvas {
  background: #fff;
  border: 2px solid #5200FF;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(82,0,255,0.08);
  display: block;
  margin: 0 auto;
  width: 500px;
  height: 500px;
  max-width: 90vw;
  max-height: 60vw;
}

#imagecanvas {
  display: none;
}

.help-btn {
  position: fixed;
  right: 32px;
  bottom: 32px;
  z-index: 1500;
  background: #5200FF;
  color: #fff;
  font-size: 2em;
  border: none;
  border-radius: 50%;
  width: 54px;
  height: 54px;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(82,0,255,0.11);
}

.help-btn:hover {
  background: #3700b3;
}

.help-modal {
  display: none;
  position: fixed;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.52);
  z-index: 2000;
  align-items: center;
  justify-content: center;
}

.help-modal[style*="flex"], .help-modal.active {
  display: flex !important;
}

.help-content {
  background: #fff;
  color: #23272e;
  border-radius: 14px;
  padding: 2.6rem 2.2rem 1.7rem 2.2rem;
  gap: 2.6rem;
  width: 900px;
  max-width: 98vw;
  box-shadow: 0 6px 40px rgba(82,0,255,0.17);
  position: relative;
  display: flex;
  gap: 2.2rem;
  flex-direction: row;
}

.help-left {
  width: 44%;
  min-width: 200px;
  max-height: 60vh;
  overflow-y: auto;
}

.help-right {
  width: 52%;
  min-width: 170px;
  max-height: 60vh;
  overflow-y: auto;
}

.help-content h2 {
  color: #5200FF;
  font-weight: 900;
  margin-top: 0;
}

.help-content ul {
  padding-left: 1.3em;
  font-size: 1.05em;
  line-height: 1.5;
}

.help-content code {
  background: #f2f0fd;
  padding: 2px 6px;
  border-radius: 5px;
  font-size: 1em;
}

.close-help {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.1em;
  cursor: pointer;
  color: #23272e;
  font-weight: 700;
}

.toolbar button {
  border: none;
  border-radius: 6px;
  padding: 0.4rem 1rem;
  font-size: 1em;
  cursor: pointer;
  font-weight: 700;
  margin-left: 0.5rem;
}


#export-pdf {
  background: #5200FF;
  color: #fff;
}

#export-pdf:hover {
  background: #3700b3;
}

.color-swatches {
  display: flex;
  flex-wrap: wrap;
  gap: 18px 14px;
  min-width: 320px;
  max-width: 98vw;
  justify-content: flex-start;
}

.swatch-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 130px;
  margin-bottom: 10px;
}

.swatch {
  width: 110px;
  height: 40px;
  border-radius: 8px;
  border: 1.2px solid #eee;
  margin-bottom: 6px;
}

.label {
  color: #23272e;
  font-size: 1em;
  font-weight: 500;
  line-height: 1.23;
  text-align: center;
  word-break: break-all;
  max-width: 130px;
  overflow-wrap: break-word;
}

body.dark .label {
  color: #fff;
}

body.dark .swatch {
  border: 1.2px solid #444;
}
.main-layout {
  background: #f3f5f8;
}

body.dark .main-layout {
  background: #23272e;
}
    
body.dark #console-output {
  background: #fff !important;
  color: #23272e !important; 
  border-color: #3dffd0 !important; 
}


.course-menu {
  position: fixed;
  top: 0;
  right: -340px;
  width: 320px;
  height: 100vh;
  background: #5200FF;
  color: #fff;
  z-index: 3000;
  box-shadow: -3px 0 24px rgba(0,0,0,0.10);
  border-radius: 16px 0 0 16px;
  display: flex;
  flex-direction: column;
  transition: right 0.33s cubic-bezier(.4,.2,.2,1), background 0.25s, color 0.25s, border-color 0.25s, box-shadow 0.25s;
  font-family: 'Roboto', Arial, sans-serif;
  max-width: 95vw;
}

.course-menu.open {
  right: 0;
}

.menu-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.4em 1.1em 1em 1.3em;
  border-bottom: 1.5px solid #fff3;
}

.menu-title {
  font-size: 1.32em;
  font-weight: 900;
  letter-spacing: 1px;
}

.close-menu {
  background: none;
  border: none;
  color: #fff;
  font-size: 2em;
  font-weight: 700;
  cursor: pointer;
  padding: 0 0.1em;
  margin-left: 8px;
  border-radius: 50%;
  line-height: 1;
}

.close-menu:hover {
  background: #fff2;
}

.menu-content {
  flex: 1 1 auto;
  overflow-y: auto;
  padding: 1.3em 1.3em 1em 1.3em;
  font-size: 1.07em;
}

.menu-content h3 {
  margin-top: 0.3em;
  margin-bottom: 1em;
  font-size: 1.09em;
  font-weight: bold;
  letter-spacing: 1px;
  color: #fff;
}

.chapter-list {
  padding-left: 0.5em;
  margin-bottom: 1.9em;
}

.chapter-list li {
  margin: 0.65em 0;
  list-style: none;
  font-size: 1em;
}

.chapter-list strong {
  color: #3dffd0;
  font-weight: bold;
}

.menu-footer {
  border-top: 1.3px solid #fff2;
  margin-top: 2em;
  padding-top: 1.2em;
  text-align: left;
}

.contact-link {
  color: #fff;
  text-decoration: underline;
  font-weight: 600;
  font-size: 1.01em;
  transition: color 0.2s;
}

.contact-link:hover {
  color: #3dffd0;
}

.menu-tab {
  position: fixed;
  top: 46%;
  right: 0;
  background: #5200FF;
  color: #fff;
  font-size: 1.13em;
  font-weight: 900;
  border: none;
  border-radius: 14px 0 0 14px;
  box-shadow: -1px 2px 10px rgba(0,0,0,0.07);
  padding: 1.06em 1.35em 1.06em 1.15em;
  cursor: pointer;
  z-index: 3010;
  letter-spacing: 1px;
  writing-mode: vertical-lr;
}

.menu-tab:hover {
  background: #3dffd0;
  color: #23272e;
}

.menu-chapter-item.active {
  background: #fff2;
  color: #3dffd0;
  font-weight: bold;
  border-radius: 8px;
}

@media (max-width: 1000px) {
  .course-menu { width: 99vw; right: -99vw; border-radius: 0; }
  .course-menu.open { right: 0; }
  .menu-tab { font-size: 1em; padding: 0.7em 1em 0.7em 0.8em; }
  .color-swatches { gap: 10px 6px; }
  .swatch-container, .swatch { width: 80px; }
  .swatch { height: 34px; }
  .label { font-size: 0.88em; max-width: 80px; }
}

.splitter {
  width: 8px;
  min-width: 8px;
  cursor: col-resize;
  background: linear-gradient(to right, #eee 0%, #ddd 100%);
  z-index: 10;
  transition: background 0.18s;
  margin: 0;
  border-radius: 7px;
  height: 100%;
}
.splitter.dragging {
  background: linear-gradient(to right, #b7b7ff 0%, #5200FF 100%);
}


.exercise-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #5200FF;
  color: #fff;
  font-size: 1.11em;
  font-weight: bold;
  border: none;
  outline: none;
  cursor: pointer;
  box-shadow: 0 1px 6px rgba(82,0,255,0.08);
  opacity: 0.7;
  position: relative;
}

.exercise-btn.current {
  background: #fff;
  color: #5200FF;
  border: 2px solid #5200FF;
  box-shadow: 0 0 0 3px #ece6fa;
  transform: scale(1.13);
  opacity: 1;
  z-index: 2;
}

.exercise-btn:disabled {
  opacity: 0.32;
  cursor: not-allowed;
}

.exercise-btn:hover:not(.current) {
  opacity: 1;
  background: #3dffd0;
  color: #5200FF;
  border: 1.5px solid #5200FF;
}

@media (max-width: 700px) {
  .exercise-progress { flex-wrap: wrap; gap: 0.32em;}
  .exercise-btn { width: 26px; height: 26px; font-size: 1em;}
}

.exercise-btn.completed {
  background: #3dffd0 !important;
  color: #5200FF !important;
  border: 2px solid #60ffa2 !important;
  opacity: 1 !important;
}

.exercise-btn.eval-success {
  background: #3dffd0 !important;
  color: #5200FF !important;
}

.exercise-btn.eval-fail {
  background: #ff1744 !important;
  color: #fff !important;
}

.modal {
  position: fixed;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.2);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

.modal-content {
  background: #fff;
  padding: 2em;
  border-radius: 12px;
  min-width: 320px;
  max-width: 94vw;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  position: relative;
  font-size: 1.09em;
}

.modal-content label {
  display: block;
  margin: 0.7em 0 0.2em;
  font-weight: 500;
}

.modal-content input[type="text"] {
  width: 100%;
  padding: 0.5em;
  font-size: 1em;
  margin-bottom: 0.7em;
  box-sizing: border-box;
  border-radius: 5px;
  border: 1px solid #ccc;
  background: #fafafa;
  color: #23272e;
}

#modal-ok {
  width: 100%;
  padding: 0.9em 0;
  font-size: 1.07em;
  background: #3dffd0;
  color: #23272e;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 0.6em;
}

.modal-close {
  position: absolute;
  top: 16px;
  right: 18px;
  font-size: 2rem;
  font-weight: bold;
  color: #222;
  cursor: pointer;
  z-index: 11;
}

body.dark {
  background: #161820;
  color: #fff;
}

body.dark .editor-pane,
body.dark .canvas-pane {
  background: #23272e;
  color: #fff;
}

body.dark #code-editor {
  background: #23272e;
  color: #fff;
}

body.dark .topbar {
  background: #23272e !important;
  border-bottom: 1.5px solid #333;
}

body.dark .console-label,
body.dark .editor-label,
body.dark .canvas-label {
  color: #fff !important;
}

body.dark #console-output {
  background: #23272e;
  color: #fff;
}

body.dark .help-content {
  background: #23272e;
  color: #3dffd0;
}

body.dark .help-content h2 {
  color: #3dffd0;
}

body.dark .help-content code {
  background: #363c4a;
  color: #fff;
  border: 1px solid #444;
  border-radius: 5px;
  padding: 2px 6px;
  font-size: 1em;
  font-family: "Fira Mono", "Consolas", monospace;
}

body.dark .help-content .label,
body.dark .help-content .rgb,
body.dark .help-content strong {
  color: #fff !important;
}

body.dark .help-content [style*="color:#333"],
body.dark .help-content [style*="color: #333"],
body.dark .help-content [style*="color:#000"],
body.dark .help-content [style*="color: #000"] {
  color: #fff !important;
}

body.dark .modal-content {
  background: #23272e;
  color: #fff;
}

body.dark .modal {
  background: rgba(20,24,32,0.7);
}

body.dark .modal-close {
  color: #3dffd0;
}

body.dark .modal-content input[type="text"] {
  background: #161820;
  color: #fff;
  border: 1px solid #3dffd0;
}

body.dark #modal-ok {
  background: #3dffd0;
  color: #23272e;
}

body.dark .swatch {
  border: 1.1px solid #444;
}

body.dark #opdracht,
body.dark #opdracht-tekst,
body.dark .opdracht {
  color: #fff !important;
}

body.dark .toolbar button {
  color: #23272e;
}

body.dark .toolbar button#toggle-theme {
  background: #b7ffef;
}

body.dark #export-pdf {
  background: #ffffff;
  color: #5200FF;
}

body.dark #saved-toast {
  background: #5200FF !important;
  color: #FFFFFF !important;
}

body.dark .splitter {
  background: linear-gradient(to right, #23272e 0%, #5200FF 100%);
}

body.dark .splitter:hover,
body.dark .splitter.dragging {
  background: linear-gradient(to right, #5200FF 0%, #3dffd0 100%);
}

@media (max-width: 980px) {
  .main-layout {
    flex-direction: column;
    gap: 3.5rem;
    max-width: 99vw;
  }
  .editor-pane,
  .canvas-pane {
    width: 98vw !important;
    min-width: 0 !important;
    max-width: none !important;
    padding: 1rem 0.5rem !important;
  }
  #turtlecanvas {
    width: 95vw;
    height: 60vw;
  }
  .help-content {
    flex-direction: column;
    width: 99vw;
  }
}
@media (max-width: 640px) {
  .topbar, .toolbar {
    flex-direction: column;
    gap: 1em;
  }
  .help-content {
    width: 99vw;
  }
  #turtlecanvas {
    height: 60vw;
  }
}
.exercise-progress {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 0.65em;
  margin: 1.2em 0 1.8em 0;
  padding-left: 4px;
}
#modal-actions {
  margin-top: 1.5em;
  text-align: right;
  display: flex;
  justify-content: center;
  gap: 1rem;              
}
@media (min-width: 1500px) {
  .main-layout {
    max-width: 1800px;
    padding-left: 5vw;
    padding-right: 5vw;
    gap: 3rem;
  }
  .editor-pane, .canvas-pane {
    min-width: 360px;
  }
  .editor-pane {
    max-width: 600px;
  }
  .canvas-pane {
    max-width: 1300px;
  }
}
.zoom-controls {
  display: flex;
  justify-content: center;
  gap: 1.5em;
  margin-top: 1em;
}

/* Brand color variables for consistency */
:root {
  --brand-purple: #5200FF;
  --brand-aqua:   #3dffd0;
  --brand-white: #ffffff;
}

/* Main circular button style */
.zoom-btn {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  font-size: 2rem;
  font-weight: bold;
  background: var(--brand-purple);
  color: var(--brand-white);
  box-shadow: 0 2px 8px rgba(82, 0, 255, 0.10);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.18s, color 0.18s, box-shadow 0.18s;
  cursor: pointer;
  outline: none;
}

/* Hover and focus: swap to aqua bg and purple text */
.zoom-btn:hover,
.zoom-btn:focus {
  background: var(--brand-aqua);
  color: var(--brand-white);
  box-shadow: 0 4px 16px rgba(61, 255, 208, 0.18);
}

/* Optional: Remove all extra color tweaks for dark mode, use the same colors always! */
@media (prefers-color-scheme: dark) {
  .zoom-btn {
    background: var(--brand-purple);
    color: var(--brand-white);
    border: 1px solid var(--brand-aqua);
    box-shadow: 0 2px 8px rgba(61, 255, 208, 0.10);
  }
  .zoom-btn:hover,
  .zoom-btn:focus {
    background: var(--brand-aqua);
    color: var(--brand-white);
    box-shadow: 0 4px 16px rgba(61, 255, 208, 0.22);
  }
}

    .modal, #ask-modal, #confirm-modal, #pdf-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.3);
  z-index: 10000;
  justify-content: center;
  align-items: center;
}
.modal[style*="flex"], #ask-modal[style*="flex"], #confirm-modal[style*="flex"], #pdf-modal[style*="flex"] {
  display: flex !important;
}
/* === Modalvenster-stijlen === */
.modal-box, #ask-modal > div, #confirm-modal > div, #pdf-modal > .modal-content {
  background: var(--brand-white);
  color: #23272e;
  border-radius: 14px;
  padding: 2em 2em 1.5em 2em;
  min-width: 320px;
  max-width: 94vw;
  box-shadow: 0 8px 32px rgba(0,0,0,0.16);
  position: relative;
  font-size: 1.09em;
  border: none;
  transition: background 0.25s, color 0.25s;
}

/* === Modale knoppen centreren === */
.modal-actions {
  display: flex;
  justify-content: center; /* Centreert de knoppen horizontaal */
  gap: 1rem;               /* Ruimte tussen knoppen */
  margin-top: 2em;
}

/* === Modale knop-stijlen (licht thema) === */
/* Deze stijl geldt voor alle modale knoppen in licht thema */
.modal-btn, .modal-box button,
#ask-modal button, #confirm-modal button, #pdf-modal button,
#modal-ok, #confirm-modal-ok, #confirm-modal-cancel, #ask-modal-ok {
  background: var(--brand-purple);    /* Paarse achtergrond */
  color: var(--brand-white);          /* Witte tekst */
  border: none;
  border-radius: 8px;
  padding: 0.7em 1.5em;
  font-size: 1.07em;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.25s, color 0.25s;
}

/* === Hover-effect (licht thema) === */
/* Kleur verandert naar aqua bij hover, tekst wordt donker */
.modal-btn:hover,
.modal-box button:hover,
#ask-modal button:hover, #confirm-modal button:hover, #pdf-modal button:hover,
#modal-ok:hover, #confirm-modal-ok:hover, #confirm-modal-cancel:hover, #ask-modal-ok:hover {
  background: var(--brand-aqua);
  color: #23272e;
}

/* === Donker thema voor modale vensters === */
body.dark .modal-box,
body.dark #ask-modal > div,
body.dark #confirm-modal > div,
body.dark #pdf-modal > .modal-content {
  background: var(--brand-purple) !important;
  color: var(--brand-white) !important;
  border: none;
}

/* === Modale knoppen: donker thema (witte knop, paarse tekst) === */
body.dark .modal-btn, 
body.dark .modal-box button,
body.dark #ask-modal button, 
body.dark #confirm-modal button,
body.dark #pdf-modal button,
body.dark #modal-ok,
body.dark #confirm-modal-ok,
body.dark #confirm-modal-cancel,
body.dark #ask-modal-ok {
  background: var(--brand-white);        /* Witte achtergrond */
  color: var(--brand-purple);            /* Paarse tekst */
  border: 1.5px solid var(--brand-purple); /* Paarse rand */
}

/* === Hover-effect voor knoppen in donker thema === */
body.dark .modal-btn:hover, 
body.dark .modal-box button:hover,
body.dark #ask-modal button:hover, 
body.dark #confirm-modal button:hover,
body.dark #pdf-modal button:hover,
body.dark #modal-ok:hover,
body.dark #confirm-modal-ok:hover,
body.dark #confirm-modal-cancel:hover,
body.dark #ask-modal-ok:hover {
  background: var(--brand-aqua);         /* Aqua achtergrond */
  color: #23272e;                        /* Donkere tekst */
  border: 1.5px solid var(--brand-aqua); /* Aqua rand */
}
.brand-btn {
  background: var(--brand-purple);    /* Paarse achtergrond */
  color: var(--brand-white);          /* Witte tekst */
  border: none;
  border-radius: 8px;
  padding: 0.7em 1.5em;
  font-size: 1.09em;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.22s, color 0.22s, border 0.22s;
  box-shadow: 0 2px 8px rgba(82,0,255,0.10);
}

/* Hover-effect in licht thema: aqua knop, donkere tekst */
.brand-btn:hover, .brand-btn:focus {
  background: var(--brand-aqua);
  color: #23272e;
  border: 1.5px solid var(--brand-aqua);
}

/* Donker thema: witte knop, paarse tekst, paarse rand */
body.dark .brand-btn {
  background: var(--brand-white);
  color: var(--brand-purple);
  border: 1.5px solid var(--brand-purple);
}

/* Donker thema hover: aqua knop, donkere tekst, aqua rand */
body.dark .brand-btn:hover, 
body.dark .brand-btn:focus {
  background: var(--brand-aqua);
  color: #23272e;
  border: 1.5px solid var(--brand-aqua);
}
    

.toolbar .brand-btn {
  background: var(--brand-purple);
  color: var(--brand-white);
  border: none;
}

body.dark .toolbar .brand-btn {
  background: var(--brand-white);
  color: var(--brand-purple);
  border: 1.5px solid var(--brand-purple);
}

body.dark .toolbar .brand-btn:hover,
body.dark .toolbar .brand-btn:focus {
  background: var(--brand-white);
  color: var(--brand-purple);
  border: 1.5px solid var(--brand-purple);
}
/* ======================= */
/* Variabelen voor kleuren */
/* ======================= */
:root {
  --brand-purple:      #5200FF;  /* Merkpaars */
  --brand-purple-dark: #3700B3;  /* Donker paars voor hover in light mode */
  --brand-white:       #FFFFFF;  /* Wit */
  --brand-aqua:        #3dffd0;  /* Accentkleur (aqua) */
}

/* ======================================================= */
/* BASISSTIJL VOOR ALLE BRAND-KNOPPEN (lichte modus)       */
/* ======================================================= */
/* Hier vallen: ‚ÄúUitvoeren‚Äù, ‚ÄúExporteren naar PDF‚Äù,       */
/* ‚ÄúVooruitgang Wissen‚Äù en de thema-toggle (#toggle-theme) */
.toolbar .brand-btn,
.run-btn {
  background: var(--brand-purple);
  color:      var(--brand-white);
  border:     none;
  transition: background 0.25s, color 0.25s;
}

/* ================================= */
/* HOVER + FOCUS (lichte modus)      */
/* ================================= */
.toolbar .brand-btn:hover,
.run-btn:hover,
.toolbar .brand-btn:focus,
.run-btn:focus {
  background: var(--brand-purple-dark);
  color:      var(--brand-white);
}

/* ======================================================= */
/* DONKER THEMA ‚Äì BASISSTIJL VOOR BRAND-KNOPPEN            */
/* ======================================================= */
/* In dark mode: witte knop met paarse tekst/rand */
body.dark .toolbar .brand-btn,
body.dark .run-btn {
  background: var(--brand-white);
  color:      var(--brand-purple);
  border:     1.5px solid var(--brand-purple);
}

/* ========================================= */
/* HOVER + FOCUS (donker thema)              */
/* ========================================= */
/* Paarse achtergrond, witte tekst           */
body.dark .toolbar .brand-btn:hover,
body.dark .run-btn:hover,
body.dark .toolbar .brand-btn:focus,
body.dark .run-btn:focus {
  background: var(--brand-purple);
  color:      var(--brand-white);
  border:     none;
}
body.dark .toolbar .brand-btn:hover,
body.dark .run-btn:hover {
  /* Accent‚Äëkleur voor hover */
  background: var(--brand-aqua) !important;
  /* Paarse tekst op licht accent */
  color: var(--brand-purple) !important;
  /* En een bijpassende rand (waar nodig) */
  border-color: var(--brand-aqua) !important;
}
/* ================================================= */
/* Basis‚Äë en hover‚Äëstijlen voor menu, help & zoom knoppen */
/* ================================================= */

/* 1) Basisstijl (light mode): paarse achtergrond, witte tekst, transparante rand */
.menu-tab,
.help-btn,
.zoom-btn {
  background: var(--brand-purple);
  color: var(--brand-white);
  border: 1.5px solid transparent;  /* nodig voor hover‚Äëborder */
}

/* 2) Hover (light mode): aqua achtergrond, paarse tekst, aqua rand */
.menu-tab:hover,
.help-btn:hover,
.zoom-btn:hover {
  background: var(--brand-aqua);
  color: var(--brand-purple);           /* paars in plaats van #23272e */
  border: 1.5px solid var(--brand-aqua);
}

/* 3) Dark mode basis: witte achtergrond, paarse tekst, paarse rand */
body.dark .menu-tab,
body.dark .help-btn,
body.dark .zoom-btn {
  background: var(--brand-white);
  color: var(--brand-purple);
  border: 1.5px solid var(--brand-purple);
}

/* 4) Hover (dark mode): aqua achtergrond, paarse tekst, aqua rand */
body.dark .menu-tab:hover,
body.dark .help-btn:hover,
body.dark .zoom-btn:hover {
  background: var(--brand-aqua);
  color: var(--brand-purple);           /* paars blijft hier ook */
  border: 1.5px solid var(--brand-aqua);
}
    
/* ============================================================================
   Help‚Äëmodal: koppen ‚ÄúFormularium‚Äù en ‚ÄúKleuren‚Äù altijd wit, ongeacht thema
   ============================================================================
*/

body.dark .help-content {
  color: var(--brand-white) !important;
}

.help-content h2 {
  color: var(--brand-purple) !important;
}
body.dark .help-content h2 {
  color: var(--brand-white) !important;
}



</style>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const CANVAS_SIZE = 500;
    let panX = 0;
    let panY = 0;
    let zoom = 1.0;
    function zoomOut() {
      zoom -= 0.1;
      draw();
    }
  </script>
  
</head>
<body>
  <!-- Topbar: opdracht, dark/light toggle en PDF export -->
  <header class="topbar">
    <div class="exercise-progress" id="exercise-progress"></div>
    <div class="opdracht" id="opdracht">
      <strong></strong> <span id="opdracht-tekst">Schrijf een programma dat een vierkant tekent met de turtle.</span>
    </div>
    <div class="toolbar">
      <button class="brand-btn" id="toggle-theme" title="Donkere/lichte modus">üåô / ‚òÄÔ∏è</button>
      <button class="brand-btn" id="export-pdf">Exporteren naar PDF</button>
      <button class="brand-btn" id="reset-progress">Vooruitgang Wissen</button>
    </div>
  </header>
<!-- Slide-in Course Menu -->
<div id="course-menu" class="course-menu" tabindex="-1" aria-label="Hoofdmenu">
  <div class="menu-header">
    <span class="menu-title">Menu</span>
    <button id="close-menu" class="close-menu" title="Sluit menu">√ó</button>
  </div>
  <nav class="menu-content">
    <h3>Inhoud</h3>
    <ul id="menu-chapters" class="chapter-list"></ul>
    <div class="menu-footer">
      <a href="https://robbewulgaert.be/contact" class="contact-link">Contact /rapporteer een bug</a>
    </div>
  </nav>
</div>


<!-- Tab to open menu -->
<button id="menu-tab" class="menu-tab" title="Toon menu">Menu</button>


<main class="main-layout" id="main-layout">
  <!-- Editor Pane (left) -->
  <section class="editor-pane" id="editor-pane">
    <div class="editor-label">Code-editor</div>
    <div id="code-editor"></div>
    </br>
    </br>
    <button id="run-code" class="brand-btn run-btn">‚ñ∂Ô∏è Uitvoeren</button>
    </br>
</br>
  
    <div class="console-label">Console-uitvoer</div>
  </br>
    <div id="console-output" class="console-output"></div>
  </section>

  <!-- The draggable splitter -->
  <div class="splitter" id="splitter"></div>

  <!-- Canvas Pane (right) -->
  <section class="canvas-pane" id="canvas-pane">
    <div class="canvas-header">
      <span class="canvas-label">Canvas</span>
      <span id="coords" class="coords"></span>
    </div>
    <canvas id="turtlecanvas" width="500" height="500"></canvas>
    <canvas id="imagecanvas" width="500" height="500" style="display:none;"></canvas>
    <div class="zoom-controls">
      <button class="zoom-btn" onclick="zoomIn()" aria-label="Zoom In">+</button>
      <button class="zoom-btn" onclick="zoomOut()" aria-label="Zoom Out">‚Äì</button>
</div>
  </section>
    <!-- Help button floating right-under -->
    <button id="help-btn" class="help-btn" title="Toon commando's en uitleg">?</button>
  </main>
  <!-- Help modal/overlay -->
  <div id="help-modal" class="help-modal">
    <div class="help-content twocol">
      <button id="close-help" class="close-help">Sluiten ‚úï</button>
      <div class="help-left">
        <h2>Formularium</h2>
        <ul>
          <li><code>console.log("tekst")</code> - print tekst naar de console</li>
          <li><code>if (voorwaarde) { ... }</code> - ALS-Statement</li>
          <li><code>else if (voorwaarde) { ... }</code> - ANDERS ALS-Statement</li>
          <li><code>else { ... }</code> - ANDERS-Statement</li>
          <li><code>for (var teller = start; teller kleiner dan eind; teller++){...}</code> - begrensde herhaling</li>
          <li><code>while (voorwaarde) { ... }</code> - voorwaardelijke herhaling</li>
          <li><code>prompt (vraag in string) { ... }</code> - vraag stellen aan user, <b>buiten SEB</b></li>
          <li><code>ask (vraag in string) { ... }</code> - vraag stellen aan user, <b>binnen SEB</b></li>
          <li><code>moveForward(afstand)</code> ‚Äì vooruit bewegen</li>
          <li><code>moveBackward(afstand)</code> ‚Äì achteruit bewegen</li>
          <li><code>turnRight(hoek)</code> ‚Äì draai naar rechts (graden)</li>
          <li><code>turnLeft(hoek)</code> ‚Äì draai naar links (graden)</li>
          <li><code>penUp()</code> ‚Äì pen omhoog</li>
          <li><code>penDown()</code> ‚Äì pen omlaag</li>
          <li><code>setPenColour(r, g, b)</code> ‚Äì verander kleur</li>
          <li><code>setPenColour("naam")</code> ‚Äì verander kleur met naam</li>
          <li><code>randomColour()</code> ‚Äì geeft een willekeurige penkleur terug (als string)</li>
          <li><code>goTo(x, y)</code> ‚Äì ga naar positie (x, y)</li>
          <li><code>showGrid(stapgrootte)</code> ‚Äì raster tonen</li>
          <li><code>setLineWidth(breedte)</code> ‚Äì lijndikte</li>
          <li><code>resetTurtle()</code> ‚Äì reset alles</li>
          <li><code>clearCanvas()</code> ‚Äì wis tekening</li>
          <li><code>writeText("tekst")</code> ‚Äì tekst schrijven</li>
          <li><code>round(getal, aantal_decimalen)</code> ‚Äì rond een getal af op zoveel decimalen</li>
        </ul>
      </div>
      <div class="help-right">
        <h2>Kleuren (naam &amp; RGB)</h2>
        <div id="dynamic-color-swatches" class="color-swatches"></div>
        <div style="font-size:0.99em;color:#333;margin-top:1em;">
          <b>Gebruik:</b><code>setPenColour(r, g, b)</code> of <code>setPenColour("naam")</code><br>
          <strong>Voorbeeld:</strong> <code>setPenColour("crimson");</code> of <code>setPenColour(220,20,60);</code>
        </div>
      </div>
    </div>
  </div>
  <!-- JS libraries & scripts: CodeMirror always first! -->
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/lib/codemirror.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/mode/javascript/javascript.min.js"></script>
  <script src="rgbcolor.js"></script>
  <script src="library.js"></script>
  
  
<div id="pdf-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="modal-close" id="close-pdf-modal">&times;</span>
    <h3>PDF Exporteren</h3>
    <label for="modal-naam">Naam:</label>
    <input id="modal-naam" type="text" required autocomplete="off">
    <label for="modal-klas">Klas:</label>
    <input id="modal-klas" type="text" required autocomplete="off">
    <label for="modal-oefening">Oefeningstitel:</label>
    <input id="modal-oefening" type="text" placeholder="(Laat leeg voor automatische titel)" autocomplete="off">
    <button id="modal-ok">Exporteren</button>
  </div>
</div>
  
<!-- modal voor prompt naar ask want SEB compat. -->
<!-- Ask Modal -->
<div id="ask-modal" class="modal-overlay" style="display:none;">
  <div class="modal-box">
    <div id="ask-modal-msg" class="modal-message"></div>
    <input id="ask-modal-input" type="text" class="modal-input" autocomplete="off"/>
    <div class="modal-actions">
      <button id="ask-modal-ok" class="modal-btn modal-btn-primary">OK</button>
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div id="confirm-modal" class="modal-overlay" style="display:none;">
  <div class="modal-box">
    <div id="confirm-modal-msg" class="modal-message modal-message-warning"></div>
    <div class="modal-actions">
      <button id="confirm-modal-ok" class="modal-btn modal-btn-primary">OK</button>
      <button id="confirm-modal-cancel" class="modal-btn">Annuleren</button>
    </div>
  </div>
</div>




  
<script>
  let dragging = false;
  let capturedOutput = "";
  document.addEventListener("DOMContentLoaded", function () {
  const menu = document.getElementById('course-menu');
  const tab = document.getElementById('menu-tab');
  const close = document.getElementById('close-menu');
  // Open menu
  tab.addEventListener('click', () => {
    menu.classList.add('open');
  });
  // Close menu
  close.addEventListener('click', () => {
    menu.classList.remove('open');
  });
  // Optionally: close if clicking outside
  document.addEventListener('click', (e) => {
    if (!menu.contains(e.target) && !tab.contains(e.target)) {
      menu.classList.remove('open');
    }
  });
});

    // ---- DRAGGABLE SPLITTER ----
document.addEventListener("DOMContentLoaded", function () {
  const splitter = document.getElementById('splitter');
  const editorPane = document.getElementById('editor-pane');
  const canvasPane = document.getElementById('canvas-pane');
  const mainLayout = document.getElementById('main-layout');
  let dragging = false;

  splitter.addEventListener('mousedown', function (e) {
    if (window.innerWidth < 980) return; // Geen drag op smalle schermen
    dragging = true;
    splitter.classList.add('dragging');
    document.body.style.userSelect = 'none';
  });

  document.addEventListener('mousemove', function (e) {
    if (!dragging || window.innerWidth < 980) return;
    const rect = mainLayout.getBoundingClientRect();
    const minEditorWidth = 220;
    const minCanvasWidth = 220;
    const splitterWidth = splitter.offsetWidth;
    const totalWidth = rect.width;
    let newEditorWidth = e.clientX - rect.left;
    const maxEditorWidth = totalWidth - splitterWidth - minCanvasWidth;
    newEditorWidth = Math.max(minEditorWidth, Math.min(maxEditorWidth, newEditorWidth));
    // Set both flex and width for maximum browser compatibility
    editorPane.style.flex = `0 0 ${newEditorWidth}px`;
    editorPane.style.width = `${newEditorWidth}px`;
    canvasPane.style.flex = '1 1 0';
    canvasPane.style.width = '';
  });

  document.addEventListener('mouseup', function () {
    if (dragging) {
      dragging = false;
      splitter.classList.remove('dragging');
      document.body.style.userSelect = '';
    }
  });

  // Reset widths on window resize if below 980px
  window.addEventListener('resize', function () {
    if (window.innerWidth < 980) {
      editorPane.style.flex = '';
      editorPane.style.width = '';
      canvasPane.style.flex = '';
      canvasPane.style.width = '';
      splitter.style.display = 'none';
    } else {
      splitter.style.display = 'block';
    }
  });
});






    // --------- DATA VOOR OEFENINGEN DATA --------------
// exercises.js

const chapters = [
  {
    title: "Hoofdstuk 1: Hello, World!",
    exercises: [
      {
        title: "1. Hello, World!",
        starterCode: [
          "// De eerste geschreven voorbeelden dateren uit 1978, uit het boek The C Programming Language.",
          "// Het eerste stuk code dat de lezer leerde, was om ‚Äòhello world‚Äô op het scherm te laten verschijnen.",
          "// En zo geschiedde! In vele andere handboeken, cursussen, programmeertalen zou deze regel code,",
          "// de ‚Äòhello world‚Äô-opdracht, de allereerste oefening zijn. Een traditie!",
          "// ",
          "// Opgave: ", 
          "// Noteer de Javascript-code om Hello, World! op het scherm te laten verschijnen.",
          "// Gebruik hiervoor de console.log()-functie.",
        ].join('\n'), 
        evalOutput: "Hello, World!"
      },
      {
        title: "2. Voornaam + Achternaam",
        starterCode: [
          "// Schrijf een coderegel die jouw voornaam op het scherm laat verschijnen;",
          "// Schrijf een coderegel die jouw familienaam op het scherm laat verschijnen;",
        ].join('\n')
      },
      {
        title: "3. Datatype String",
        starterCode: [
          "// Gebruik de correcte aanhalingstekens",
          "// om volgende zinnen op het scherm te schrijven:",
          "// De kat krabt de krollen van de trap.",
          '// Robbe zei tegen vader "Zou je dat nou wel doen?"',
          "// Isaura's nieuwe auto.",
        ].join('\n'), 
        evalOutput: "De kat krabt de krollen van de trap.\n"+'Robbe zei tegen vader "Zou je dat nou wel doen?"\n'+"Isaura's nieuwe auto."

      },
      {
        title: "4. Concateneren Met Strings",
        starterCode: [
          "// Gebruik vier variabelen en het datatype string.",
          "// Gebruik de console.log-functie en concateneren om", 
          "// volgende zin naar het scherm te printen:", 
          "// Helmut Lotti, geboren in Gent, woont in de Dorpstraat 13, Sint-Amandsberg.", 
          "// Let op voor het leesteken!",
          "var voornaam = ...;",
          "var familienaam = ...;",
          "var geboorteplaats = ...;",
          "var adres = ...;",
          "console.log(...);",
        ].join('\n'), 
        evalOutput: "Helmut Lotti, geboren in Gent, woont in de Dorpstraat 13, Sint-Amandsberg."

      },
      {
        title: "5. Goedemorgen, Robot!",
        starterCode: [
          "// Bedenk zelf leesbare variabelen om volgende zin",
          "// op het scherm te laten verschijnen:", 
          "// Goedemorgen mevr. Deleye, vandaag heeft u op de planning: vergadering met regionaal manager Sufyan Y.", 
          "// var ...",
          "// var ...",
          "// ...",
          "// console.log(...);",
        ].join('\n'), 
          evalOutput: "Goedemorgen mevr. Deleye, vandaag heeft u op de planning: vergadering met regionaal manager Sufyan Y."

      },
      {
        title: "6. Sportresultaten",
        starterCode: [
          "// Het VRT Nieuws wil een databank aanmaken met alle sportmatchen die gespeeld zijn en hun scores.",
          "// We gebruiken hierbij volgende informatie, opgeslagen in variabelen:",
          "// thuisteam, uitteam, sport, datum, score",
          "// Gebruik variabelen, console.log, strings en concatenatie om volgende zin op het scherm te zetten:", 
          "// Op 23/01/2009 speelde KAA Gent een voetbal-match tegen Club Brugge die eindigde op 3-1.", 
        ].join('\n'), 
          evalOutput: "Op 23/01/2009 speelde KAA Gent een voetbal-match tegen Club Brugge die eindigde op 3-1."

      },
      {
        title: "7. Naam Plotten",
        starterCode: [
          "// Naast de console kan je ook strings schrijven op het canvas.",
          "// Hiervoor tekenen we eerst het assenstelsel op het scherm:",
          " ",
          "showGrid();", 
          " ",
          "// Met het commando writeText() kan je een string of variabele met datatype string schrijven.",
          "// Opgave: schrijf jouw volledige naam in de console √©n op het canvas.",
          "// Gebruik een gepaste variabele.", 
          " ",
          "writeText('Lees de opgave');", 
        ].join('\n')
      },
      {
        title: "8. Namen Plotten",
        starterCode: [
          "// Maak vier variabelen aan.",
          "// Bewaar de namen van jezelf en drie vrienden in die variabelen.", 
          "// Plot die vier namen in het canvas.", 
          "// Zorg ervoor dat er slechts 1 naam per kwadrant genoteerd wordt.",
          "// Je kan jouw co√∂rdinaten aanpassen met onderstaand commando:", 
          "// goTo(X, Y);",
          " ",
          "showGrid();",
          "penUp();",
        ].join('\n')
      },
      {
        title: "9. Scorebord",
        starterCode: [
          "// We ontwerpen een scorebord met daarop volgende informatie:", 
          "// Vier uitslagen van recente sportwedstrijden.", 
          "// Elke uitslag kent: datum, thuisploeg - uitploeg, eindscore.", 
          "// Die informatie moet netjes onder elkaar geordend worden.",
          "// Er mag slechts 1 uitslag per kwadrant weergegeven worden.",
           " ",
          "showGrid();",
          "penUp();",
          
        ].join('\n')
      },
    ]
  },
  {
    title: "Hoofdstuk 2: Datatypes en de Sequentie",
    exercises: [
      {
        title: "1. Defect Geldautomaat",
        starterCode: [
          "// Fred heeft voor zijn rondreis wat geld opzij gezet op een zichtrekening. Daar staat momenteel 500 euro op.",
          "// Omdat er deze reis nog enkele grote kosten zitten aan te komen, besluit Fred hier 275 euro bij te storten.",
          "// Hij gaat naar een bank in de buurt van een camping waar hij verblijft. Eenmaal bij de bank stelt hij vast dat er iets fout loopt met de terminal.",
          "// Er werd gemorreld met de code van de automaat!", 
          "// Bekijk de code hieronder en pas de fout aan.", 
          " ", 
          "var rekening = '500';", 
          "var storting = '275';", 
          "var rekening = rekening + storting",
          "console.log('Uw nieuw saldo bedraagt ' + rekening + ' euro.');", 
        ].join('\n'), 
        evalOutput: "Uw nieuw saldo bedraagt 775 euro."
      },
      {
        title: "2. Statiegeld",
        starterCode: [
          "// Het kassasysteem aan een tankstation lijkt een eigenaardige berekening te maken.",
          "// Fred koopt er vier flesjes cola aan 3.50 euro per stuk.",
          "// Daarboven hoort Fred ook 10% taks te betalen in de vorm van statiegeld.",
          "// De kassa levert volgend resultaat:",
          "// 1 x Cola 0.5l = 3.5",
          "// 10% van 3.5 = 0.35",
          "// 4 x 3.5 ",
          "// + 0.35",
          "// = 14.35 euro totaal",
          
          "// Corrigeer bovenstaand algoritme.", 
          "// Hanteer leesbare variabelen in jouw algoritme.",
        ].join('\n'), 
        evalOutput: "Fred moet 15.4 euro betalen."
      },
         {
        title: "3. Operatoren in JavaScript",
        starterCode: [
          "// JavaScript kan overweg met verschillende operatoren.",
          "// Voer onderstaande code uit.",
          "// Noteer vervolgens naast de commenttekens hoe die bewerking heet.",
          "// Volg het voorbeeld!",
          " ", 
          "var x = 10;",
          "var y = 5;",
          "var z = 4;",
          "console.log(x + y); // som maken",
          "console.log(x - z); // verschil maken",
          "console.log(x * y); // ... ",
          "console.log(x / z); // ... ",
          "console.log(x ** y); // ... ",
          "console.log(x % z); // ... ",
        ].join('\n'), 
          evalOutput: "15\n6\n50\n2.5\n100000\n2"
      },
      {
        title: "4. Voetbalveld",
        starterCode: [
          "// Fred wil berekenen hoeveel vierkante meter grasmatten men heeft moeten bestellen voor die heraanleg.",
          "// Hij weet, uit zijn ervaring als amateurvoetballer, dat een standaard voetbalveld 105 meter bij 68 meter meet.",
          "// Hij wil dus de oppervlakte van het veld berekenen.",
          "// Maak dit algoritme. Maak gebruik van leesbare variabelen.",
          "// Print het antwoord in een volzin naar het scherm. De volzin bevat een onderwerp, werkwoordsvorm en eenheid (=vierkante meter).",
        ].join('\n'), 
        evalOutput: "De oppervlakte van het voetbalveld is 7140 vierkante meter."
      },
      {
        title: "5. Zwembad",
        starterCode: [
          "// Op de camping waar Fred verblijft is er ook een zwembad.",
          "// Fred vraagt zich af of hij zijn code ook kan gebruiken om het volume van het zwembad te berekenen.",
          "// Het zwembad bestaat uit twee delen die aan elkaar grenzen.",
          "// 1 - een rechthoekig gedeelte met 1.5 meter diepte, 11 meter breedte en 20 meter lengte (=balkvorm);",
          "// 2 - een cirkelvorming gedeelte voor kinderen van 0.60 meter diep en 10 meter diameter (=cilindervorm).",
          " ",
          "// Bereken het volume van het volledige zwembad met leesbare variabelen.",
          "// Print het antwoord in een volzin naar het scherm.",
          "// De volzin bevat een onderwerp, werkwoordsvorm en eenheid (=kubieke meter);",
        ].join('\n'), 
        evalOutput: "Het totale volume van het zwembad is 377.1 kubieke meter."
      },
      {
        title: "6.  Omtrek en oppervlakte rechthoek",
        starterCode: [
          "// Een rechthoek is een figuur met twee paar evenwijdige en even lange zijden.",
          "// Wij willen hiervan de oppervlakte en de omtrek berekenen en tonen op het scherm.",
          "// Maak een variabele genaamd zijde_1 en voer daar in: 9.75.",
          "// Maak een variabele genaamd zijde_2 en voer daar in: 8.60.",
          "// Bereken oppervlakte en omtrek.",
          "// Print jouw resultaat naar het scherm in volgend formaat:",
          "// De omtrek van de rechthoek is 36.7 cm en de oppervlakte is 83.85 cm¬≤.",
        ].join('\n'), 
        evalOutput: "De omtrek van de rechthoek is 36.7 cm en de oppervlakte is 83.85 cm¬≤."
      },
      {
        title: "7. Omtrek en oppervlakte vierkant",
        starterCode: [
          "// Maak een variabele genaamd zijde en voer daar de data in.",
          "// Bereken daarna de omtrek van het vierkant.",
          "// Bereken vervolgens de oppervlakte van het vierkant.",
          "// Print jouw resultaat naar het scherm in volgend formaat:",
          "// De omtrek van het vierkant is 66.0 cm en de oppervlakte is 272.25 cm¬≤.",
        ].join('\n'), 
        evalOutput: "De omtrek van het vierkant is 66.0 cm en de oppervlakte is 272.25 cm¬≤."
      },
      {
        title: "8. Stappenteller",
        starterCode: [
          "// Het Vlaams Instituut Gezond Leven lanceerde in 2022 de campagne ‚Äú10‚Äâ000 stappen: elke stap telt!‚Äù",
          "// Schrijf een programma waarin je opgeeft hoeveel stappen je vandaag reeds gezet hebt.",
          "// Bereken vervolgens hoeveel stappen je nog moet zetten.",
          "// Maak een variabele genaamd aantal_stappen en voer daar de data in.",
          "// Bereken daarna de rest_stappen.",
          "// Print jouw resultaat naar het scherm in volgend formaat:",
          "// Je dient nog 4658 stappen te zetten.",
        ].join('\n'), 
        evalOutput: "Je dient nog 4658 stappen te zetten."
      },
      {
        title: "9. Korting In De Supermarkt",
        starterCode: [
          "// In de supermarkt nabij de camping houden ze momenteel stapelkorting.",
          "// 10% korting op aangekochte frisdranken.",
          "// 20% korting op broodartikelen.",
          "// 33% korting op groenten en fruit.",
          " ", 
          "// Fred koopt volgende items aan in de winkel: ",
          "// 6 blikjes frisdrank aan 0.89 euro per stuk.", 
          "// 10 croissants aan 0.35 euro per stuk.",
          "// 0.7kg bananen aan 2.99 euro per kilo.", 
          " ",
          "// Print jouw resultaat naar het scherm in volgend formaat:",
          "// Fred moet in totaal ... euro betalen aan de kassa.",
        ].join('\n'), 
        evalOutput: "Fred moet in totaal 9.00831 euro betalen aan de kassa."
      },
      {
        title: "10. Huurwaarborg",
        starterCode: [
          "// Fred verhuist naar een huisje aan de Vrijdagsmarkt in Gent.",
          "// Hij moet een huurwaarborg betalen van drie maal de maandhuur.",
          "// De maandhuur bedraagt 799 euro.",
          "// Maar na vijf jaar belooft de bank Fred wel een mooie interest van 19.87% op de waarborg.",
          " ", 
          "// Bereken het totaalbedrag dat Fred zal krijgen, na 5 jaar, wanneer hij het geld van de waarborgrekening terug krijgt. ",
          "// Print jouw resultaat naar het scherm in volgend formaat:",
          "// Na vijf jaar krijgt Fred ... euro terug van zijn waarborg.",
        ].join('\n'), 
        evalOutput: "Na vijf jaar krijgt Fred 2877.16 euro terug van zijn waarborg."
      },
      {
        title: "11. Energiefactuur",
        starterCode: [
          "// Naast een maandelijkse huur, moet Fred natuurlijk ook de energiefactuur in het oog houden. ",
          "// Zo betaalde Fred vorig jaar nog 44.54 euro per maand aan elektriciteit.",
          "// Tegenwoordig is dat bedrag gestegen naar 68.9 euro per maand.",
          " ", 
          "// Bereken volgende gegevens:",
          "// Het totaalbedrag dat Fred dit jaar (=12 maanden) zal moeten betalen.",
          "// Hoeveel hij meer moet betalen dan het jaar ervoor, uitgedrukt in euro.",
          "// Hoeveel hij meer moet betalen dan het jaar ervoor, uitgedrukt in procent.",
          "// Print het antwoord naar het scherm in een volzin met volgend formaat:",
          "// Fred moet dit jaar ... euro betalen voor de elektriciteit.", 
          "// Dit is ... euro meer dan vorig jaar.",
          "// In procenten uitgedrukt, is dit een stijging van ... % ten opzichte van vorig jaar.", 
        ].join('\n'), 
        evalOutput: 
    "Fred moet dit jaar 826.80 euro betalen voor de elektriciteit.\n" +
    "Dit is 292.32 euro meer dan vorig jaar.\n" +
    "In procenten uitgedrukt, is dit een stijging van 54.4 % ten opzichte van vorig jaar."
      },
      {
        title: "12. Raakt Fred Op De Bestemming?",
        starterCode: [
          "// Fred maakt een reis met de e-car in Frankrijk.",
          "// Zijn auto heeft een autonomie van 350 mijl.",
          "// Fred weet: 1 mijl = 1.6 kilometer.",
          "// Fred besluit komende dagen vier etappes te rijden van elk 112.34km. ",
          "// Hoeveel blijft er nadien nog over in de batterij van zijn wagen?", 
          "// Gebruik volgend formaat om jouw antwoord op het scherm te zetten: ", 
          "// Na de vier etappes van elk ... km, blijft er nog ... kilometer over in de batterij van Freds wagen.",
          "// Dit komt overeen met ...% van de totale batterijcapaciteit.",
        ].join('\n'), 
        evalOutput: 
    "Na de vier etappes van elk 112.34 km, blijft er nog 47.6 kilometer over in de batterij van Freds wagen.\n" +
    "Dit komt overeen met 19.757142857142853% van de totale batterijcapaciteit."
      },
    ]
  },
  
  {
    title: "Hoofdstuk 3: De Selectie",
    exercises: [
      {
        title: "1. Gelijk Aan",
        starterCode: [
          "// Voer onderstaande code uit.",
          "// Merk op: binnen de code vind je enkele en dubbele gelijkheidstekens.",
          "// Noteer naast de dubbele forward slash de functie van beiden.",
          "// Pas daarna de code aan zodat je oneven getallen kan opsporen.",
          " ",
          "var getal = X ;",
          "// Vul aan: een enkelvoudig gelijkheidsteken ...",
          " ",
          "if (getal % 2 == 0  ) {",
          "// Vul aan: een dubbel gelijkheidsteken ...",
          "console.log('Het getal ' + getal + ' is een even getal.' );",
          "}",
        ].join('\n'), 
        evalOutput: "Het getal 4 is een even getal."
      },
      {
        title: "2. Else Statement",
        starterCode: [
          "// Pas onderstaande code aan zodat je even of oven getallen kan vinden.",
          "// Gebruik hiervoor slechts 1 if-statement en 1 else-statement.",
          " ",
          "// Pas daarna de code aan zodat je oneven getallen kan opsporen.",
          " ",
          "var getal = X ;",
          "if (getal % 2 == 0  ) { ",
          "console.log('Het getal ' + getal + ' is een even getal.' );",
          "}",
        ].join('\n'), 
        evalOutput: "Het getal 7 is een oneven getal."
      },
      {
        title: "3. Else If Statement",
        starterCode: [
          "// In de vorige oefening maakten we een algoritme dat",
          "// even of oneven getallen kan opsporen. Maar wat met het getal 0?",
          "// Pas jouw algoritme aan zodat hij drie mogelijke uitkomsten kan bereiken:",
          "// even, oneven of het getal is gelijk aan nul.",
          "// Gebruik onderstaande structuur als startpunt:",
          " ",
          "if (voorwaarde WAAR is) {",
          "console.log(...);",
          "}",
          "else if (nieuwe voorwaarde {)",
          "console.log(...);",
          "}",
          "else {",
          "console.log(...);",
          "}",
        ].join('\n'), 
        evalOutput: "Het getal is gelijk aan nul."
      },
      {
        title: "4. Tolwegen in Frankrijk",
        starterCode: [
          "// Tolwegen zijn wegen die heel goed onderhouden zijn, maar waar je moet betalen voordat je ze mag gebruiken.",
          "// Tijdens de rondrit moet Fred zo een tolweg gebruiken.",
          "// Hij staat aan een tussenstop en bekijkt de tarieflijst.", 
          "// * Auto met verbrandingsmotor: 11.60 euro;",
          "// * Auto met elektrische motor: 8.90 euro; ", 
          "// * Lichte vracht: 14.50 euro;", 
          "// * Vrachtwagen: 19.20 euro.", 
          " ",
          "// Schrijf een algoritme en code waarmee je kan bepalen hoeveel moet worden betaald;",
          "// Maak gebruik van de IF, ELSE en ELSE IF-statements;",
          "var type = 'Auto met elektrische motor';",
          "if ... ",
        ].join('\n'), 
        evalOutput: "Te betalen: 8.90 euro."
      },
      {
        title: "5. Aanmelden",
        starterCode: [
          "// Op zijn camping nabij Nice maakt hij verbinding met een Wi-Fi Access Point. ",
          "// Het wachtwoord is: @B0nJ0uR!",
          " ",
          "// Schrijf een algoritme en code waar je een wachtwoord moet invullen.",
          "// Wanneer het wachtwoord correct is ingevuld, verschijnt op het scherm 'Verbinding gelukt';",
          "// Wanneer het wachtwoord niet correct is ingevuld, verschijnt op het scherm 'Verbinding mislukt'; ",

        ].join('\n'), 
        evalOutput: "Verbinding gelukt"
      },
      {
        title: "6. Madame Boulang√®re",
        starterCode: [
          "// Fred trakteert zijn vrienden op taart.",
          "// Omdat ze met 30 personen zijn, besluiten ze vijf taarten met zich mee te brengen.",
          "// Bij de bakker vinden ze volgende formule:",
          "// * Taart (voor 10 personen) = 29.5 euro.",
          "// * 2 taarten: -5 euro.",
          "// * 3 taarten: 10% korting.",
          "// * 4 of meer taarten: 32% korting.",
          " ",
          "// Maak een algoritme dat de totaalprijs voor X-taarten kan berekenen.",
          "// Test jouw algoritme door te berekening te maken voor 2 taarten, 3 taarten en 5 taarten", 
          "// Print jouw antwoord telkens naar het scherm in volgende vorm:",
          "console.log('Voor X taarten betalen ze ... euro.')",
        ].join('\n'), 
        evalOutput: "Voor 5 taarten betalen ze 100.30000000000001 euro."
      },
      {
        title: "7. Hittegolf",
        starterCode: [
          "// Pas onderstaande code aan zodat je even of oven getallen kan vinden.",
          "// Gebruik hiervoor slechts 1 if-statement en 1 else-statement.",
          " ",
          "// Pas daarna de code aan zodat je oneven getallen kan opsporen.",
          " ",
          "var getal = X ;",
          "if (getal % 2 == 0  ) { ",
          "console.log('Het getal ' + getal + ' is een even getal.' );",
          "}",
        ].join('\n'), 
        evalOutput: "Het getal 14 is een even getal."
      },
      {
        title: "8. Korting Museumbezoek",
        starterCode: [
          "// Tijdens het reizen bezoekt Fred een aantal musea. ",
          "// Hij kan er, doordat hij nog relatief jong is (25 jaar), vrij goedkoop binnen. ",
          "// De toegangsprijzen voor een museum:",
          "// * volwassene (26 jaar of ouder): 10 euro.",
          "// * Jongvolwassene (18 of ouder, maar jonger dan 26): 4 euro.",
          "// * Jongere (jonger dan 18 jaar): 2 euro. ",
          " ",
          "// Schrijf een algoritme en code waarmee je kan bepalen hoeveel een bezoeker moet betalen.",
          "// Test jouw algoritme gronding voor de drie scenario‚Äôs.",
          "// Zorg voor een verzorgde volzin bij elke uitkomst: De toegangsprijs is ... euro.",
        ].join('\n'), 
        evalOutput: "De toegangsprijs is 4 euro."
      },
      {
        title: "9. Feestpleinen Gentse Feesten",
        starterCode: [
          "// Sinds dit jaar maken de organisatoren van de feesten gebruik van een computerprogramma met camera‚Äôs",
          "// die de drukte op de pleinen kunnen nagaan. De pleinen sluiten wanneer ze:",
          "// * volzet zijn (maximumcapaciteit is bereikt), OF;",
          "// * het sluitingsuur bereikt is.",
          "// Bijvoorbeeld: Korenmarkt: maximum 40.000 personen OF sluit om 23 uur; ",
          " ",
          "// Schrijf een oplossing waarbij de gebruiker een uur (=geheel getal) en het aantal personen moet invoeren.",
          "// Print het resultaat (plein sluiten of open houden) op het scherm met een correcte volzin, bv.:",
          "// 'Het plein moet sluiten.' of 'Het plein kan open blijven.'",
          " ",
          "if (voorwaarde_1 || voorwaarde_2) { actie; }", 
          "// de twee streepjes || betekenen OR, in het Nederlands OF",
        ].join('\n'),
        evalOutput: "Het plein moet sluiten."
      },
      {
        title: "10. Herhalingsoefening If-Statement",
        starterCode: [
          "// Schrijf een algoritme dat: ",
          "// * De gebruiker vraagt naar zijn/haar/hun leeftijd.",
          "// * Stel de prijs voor het toegangsticket voor het museum van de oudheden in Leiden in op 10 euro.",
          "// * ALS de leeftijd lager is dan 19 jaar, verminder je de prijs met 5.5 euro.",
          "// * Print de prijs naar het scherm in een volzin.",
        ].join('\n'), 
        evalOutput: "De toegangsprijs is 4.5 euro."
      },
      {
        title: "11. Herhalingsoefening Else-Statement",
        starterCode: [
          "// Schrijf een programma dat de gebruiker vraagt om zijn/haar/hun leeftijd in te voeren.",
          "// Vervolgens controleert of hij/zij oud genoeg is om te stemmen.",
          "// Als de gebruiker 18 jaar of ouder is, moet het programma ‚ÄúJe bent oud genoeg om te stemmen!‚Äù afdrukken.",
          "// Anders de gebruiker jonger is dan 18 jaar, moet het programma ‚ÄúSorry, je bent nog niet oud genoeg om te stemmen‚Äù afdrukken.",
        ].join('\n'), 
        evalOutput: "Je bent oud genoeg om te stemmen!"
      },
      {
        title: "12. Herhalingsoefening Else If-Statement",
        starterCode: [
          "// Schrijf een algoritme dat:",
          "// * De gebruiker vraagt om twee getallen (getal1 en getal2) in te voeren en ",
          "// * Controleert of het eerste getal groter is dan het tweede getal.",
          "// * Als het eerste getal groter is dan het tweede getal, moet het programma ‚ÄúHet eerste getal is groter‚Äù afdrukken.",
          "// * Anders als het tweede getal groter is dan het eerste getal, moet het programma ‚ÄúHet tweede getal is groter‚Äù afdrukken.",
          "// * Als de twee getallen gelijk zijn, moet het programma ‚ÄúDe twee getallen zijn gelijk‚Äù afdrukken.",

        ].join('\n'), 
        evalOutput: "Het tweede getal is groter."
      },
    ]
  },
  {
    title: "Hoofdstuk 4: Figuren Plotten",
    exercises: [
  // 1. Eenvoudig vierkant
  {
    title: "1. Vierkant Tekenen",
    starterCode: [
      "// Teken een vierkant met zijden van 50px.",
      "// Gebruik een variabele voor de lengte.",
      "showGrid(50);",
      "var zijde = 50;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 2. Rechthoek tekenen
  {
    title: "2. Rechthoek Tekenen",
    starterCode: [
      "// Teken een rechthoek met lengte 80px en breedte 40px.",
      "// Gebruik twee variabelen.",
      "showGrid(50);",
      "var lengte = 80;",
      "var breedte = 40;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 3. Gelijkzijdige driehoek met goTo()
  {
    title: "3. Gelijkzijdige Driehoek",
    starterCode: [
      "// Teken een driehoek met zijden van 60px.",
      "// Gebruik goTo om naar het startpunt te gaan.",
      "showGrid(50);",
      "goTo(50, 50);",
      "var zijde = 60;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 4. Vierkant op een andere plek (co√∂rdinaten)
  {
    title: "4. Vierkant op Co√∂rdinaten",
    starterCode: [
      "// Zet de turtle op (100, 50) en teken daar een vierkant met zijden van 40px.",
      "showGrid(50);",
      "goTo(100, 50);",
      "penDown();",
      "var zijde = 40;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 5. Tekst schrijven op de canvas
  {
    title: "5. Zijden Annoteren",
    starterCode: [
      "// Teken een vierkant en schrijf de zijde naast het figuur.",
      "showGrid(50);",
      "var zijde = 60;",
      "// Teken het vierkant",
      "// Zet pen omhoog, verplaats en schrijf de tekst",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 6. Penkleur veranderen
  {
    title: "6. Gekleurd Vierkant",
    starterCode: [
      "// Zet de penkleur op blauw en teken een vierkant van 50px.",
      "showGrid(50);",
      "setPenColour('blue');",
      "var zijde = 50;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 7. Lijndikte aanpassen
  {
    title: "7. Lijndikte Aanpassen",
    starterCode: [
      "// Zet de lijndikte op 6 en teken een vierkant met rode zijden.",
      "showGrid(50);",
      "setPenColour('red');",
      "setLineWidth(6);",
      "var zijde = 40;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 8. Twee figuren met verschillende kleuren
  {
    title: "8. Twee Figuren",
    starterCode: [
      "// Teken een groen vierkant.",
      "// Zet daarna de penkleur op oranje en teken een cirkel.",
      "showGrid(50);",
      "setPenColour('green');",
      "var zijde = 40;",
      "// Teken het vierkant",
      "setPenColour('orange');",
      "// Teken de cirkel (tip: cirkelcommando!)"
    ].join('\n')
  },
  // 9. Verschillende vierkanten met verschillende zijden
  {
    title: "9. Verschillende Vierkanten",
    starterCode: [
      "// Teken drie vierkanten met zijden 30px, 50px en 70px.",
      "// Elk vierkant heeft een andere kleur.",
      "showGrid(50);",
      "var zijde1 = 30;",
      "var zijde2 = 50;",
      "var zijde3 = 70;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 10. Penkleur kiezen met if
  {
    title: "10. Kleurkeuze met if",
    starterCode: [
      "// Gebruik een variabele kleurKeuze.",
      "// Als kleurKeuze 'rood' is, teken een rood vierkant. Anders teken een blauw vierkant.",
      "showGrid(50);",
      "var kleurKeuze = 'rood'; // of 'blauw'",
      "var zijde = 40;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 11. Penkleur kiezen met if-else if-else
  {
    title: "11. Kleurkeuze met if-else if-else",
    starterCode: [
      "// Kies een penkleur op basis van kleurKeuze: 'rood', 'groen' of 'blauw'.",
      "showGrid(50);",
      "var kleurKeuze = 'groen';",
      "var zijde = 35;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 12. Dikte en kleur aanpassen afhankelijk van zijde
  {
    title: "12. Kleur en Dikte op Basis van Zijde",
    starterCode: [
      "// Stel een variabele zijde in.",
      "// Als zijde kleiner dan 40, teken dun en rood.",
      "// Anders teken dik en blauw.",
      "showGrid(50);",
      "var zijde = 35;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 13. Vierkant tekenen met input
  {
    title: "13. Zijde Opvragen",
    starterCode: [
      "// Vraag aan de gebruiker hoe lang de zijde moet zijn en teken een vierkant.",
      "showGrid(50);",
      "var zijde = parseInt(ask('Hoe lang is de zijde?'));",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 14. Vierkant tekenen op basis van een berekening
  {
    title: "14. Berekenen met Variabelen",
    starterCode: [
      "// Bereken de zijde door 100 te delen door 2, teken het vierkant.",
      "showGrid(50);",
      "var zijde = 100 / 2;",
      "// Vul hieronder jouw code in"
    ].join('\n')
  },
  // 15. Creatieve opdracht: alles combineren
  {
    title: "15. Creatieve Opdracht: Combineren",
    starterCode: [
      "// Maak een ontwerp met minstens twee figuren.",
      "// Gebruik verschillende kleuren, penbreedtes, variabelen en co√∂rdinaten.",
      "// Experimenteer met alles wat je hebt geleerd tot nu toe!",
      "showGrid(50);"
    ].join('\n')
      },
    ]
  },
  {
    title: "Hoofdstuk 5: De Begrensde Herhaling",
    exercises: [
{
  title: "1. Countdown naar Lancering",
  starterCode: [
    "// Print een aftelling van 10 tot 0 op het scherm.",
    "// Toon bij 0 het woord 'LANCERING!'.",
    "",
    "for(var teller = 10; teller >= 0; teller--){",
    "...", 
    "  }",
  ].join('\n'), 
    evalOutput: [
    "10",
    "9",
    "8",
    "7",
    "6",
    "5",
    "4",
    "3",
    "2",
    "1",
    "0",
    "LANCERING!"
  ].join('\n')
},
{
  title: "2. Verzamel dorpen van Fred",
  starterCode: [
    "// Vraag 5 keer een dorp aan de gebruiker en voeg toe aan een lijst.",
    "// Toon op het einde: Dag mama, ik ben nog steeds op reis. Ik bezocht: ...",
    "// De vijf dorpen zijn: Bomal, Durbuy, Mormont, Manhay, Spa, Stoumont", 
    "",
    "var lijst_tussenstops = 'Bomal';",
    "for(var teller = 0; teller < 5; teller++){",
    "  var tussenstop = ask('Voer een tussenstop in');",
    "  ...",
  ].join('\n'), 
  evalOutput: "Dag mama, ik ben nog steeds op reis. Ik bezocht: Bomal, Durbuy, Mormont, Manhay, Spa, Stoumont"

},
{
  title: "3. Totale afstand berekenen",
  starterCode: [
    "// Vraag 5 keer een afstand aan de gebruiker en tel alles op.",
    "// Toon op het einde: De totale afstand die ik heb afgelegd is: ... km.",
    "// De afstanden zijn: 245.2km, 199.2km, 312km, 231km, 119.4km.",
    "",
    "var totaal = 0;",
    "for(var i = 1; i <= 5; i++){",
    "  var afstand = parseFloat(ask('Geef de afstand van rit ' + i + ' in km:'));",
    "...",
    "console.log('De totale afstand die ik heb afgelegd is: ... km.');",
  ].join('\n'),
  evalOutput: "De totale afstand die ik heb afgelegd is: 1107.8 km."
},
{
  title: "4. Bosbrand Per Dag",
  starterCode: [
    "// Bereken per dag (7 dagen) het afgebrande gebied.",
    "// Elke dag is er dus meer bos verdwenen.",
    "// Print per dag: Op dag ... is er ... m¬≤ bos afgebrand.",
    "",
    "var totaal = 0;",
    "var lengte = 329;",
    "var breedte = 277.32;",
    "for(var dag = 1; dag <= 7; dag++){",
    "  ...",
    "}",
  ].join('\n'), 
    evalOutput:
    "Op dag 1 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 2 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 3 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 4 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 5 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 6 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 7 is er 91236.28 m¬≤ bos afgebrand."
},
{
  title: "5. Waarborg met Interest",
  starterCode: [
    "// Bereken de waarborg voor elk jaar (5 jaar), groei 3% per jaar.",
    "// Toon: Na jaar ... is de waarborg gegroeid tot ... euro.",
    "",
    "var maandhuur = 695;",
    "var waarborg = maandhuur * 3;",
    "for(...){",
    "...",
    "}"
  ].join('\n'),
  evalOutput:
    "Na jaar 1 is de waarborg gegroeid tot 2147.55 euro.\n" +
    "Na jaar 2 is de waarborg gegroeid tot 2211.98 euro.\n" +
    "Na jaar 3 is de waarborg gegroeid tot 2278.34 euro.\n" +
    "Na jaar 4 is de waarborg gegroeid tot 2346.69 euro.\n" +
    "Na jaar 5 is de waarborg gegroeid tot 2417.09 euro."
},
{
  title: "6. Bevolkingsgroei Montpellier",
  starterCode: [
    "// Bereken de bevolking van Montpellier voor 10 jaar met 3.1% groei.",
    "// Toon: In het jaar ... is de bevolking ... inwoners.",
    "// We starten in het jaar 2025.",
    "",
    "var bevolking = 295542;",
    "for(...){",
    "...",
    "}"
  ].join('\n'),
  evalOutput:
    "In het jaar 2025 is de bevolking 304722 inwoners.\n" +
    "In het jaar 2026 is de bevolking 314178 inwoners.\n" +
    "In het jaar 2027 is de bevolking 323921 inwoners.\n" +
    "In het jaar 2028 is de bevolking 333959 inwoners.\n" +
    "In het jaar 2029 is de bevolking 344303 inwoners.\n" +
    "In het jaar 2030 is de bevolking 354964 inwoners.\n" +
    "In het jaar 2031 is de bevolking 365954 inwoners.\n" +
    "In het jaar 2032 is de bevolking 377282 inwoners.\n" +
    "In het jaar 2033 is de bevolking 388962 inwoners.\n" +
    "In het jaar 2034 is de bevolking 400999 inwoners."
},
{
  title: "7. Hittegolfalarm",
  starterCode: [
    "// Vraag 5 temperaturen op, tel telkens wanneer de temp. > 25¬∞C.",
    "// Toon 'Alarm: hittegolf!' als alle 5 temperaturen > 25, anders 'Geen hittegolf.'",
    "// Je zal twee IF-Statements moeten gebruiken.",
    "",
    "var alarmTeller = 0;",
    "for(var i = 1; i <= 5; i++){",
    "  var temp = parseFloat(ask('Geef temperatuur ' + i + ' in ¬∞C:'));",
    "  ...",
  ].join('\n'), 
  evalOutput: "Alarm: hittegolf!"
},
{
  title: "8. Gemiddelde Score Kerstrapport",
  starterCode: [
    "// Vraag 6 scores op en bereken het gemiddelde.",
    "// De scores: 88, 77, 93, 60, 70, 62.",
    "",
    "var som = 0;",
    "for(var i = 1; i <= 6; i++){",
    "  var score = parseFloat(ask('Geef score ' + i + ' (op 100):'));",
    "  ...",
  ].join('\n'), 
  evalOutput: "Het gemiddelde is 75.67"
}
]
},
  {
    title: "Hoofdstuk 6: De Voorwaardelijke Herhaling",
    exercises: [
{
  title: "1. Countdown naar Lancering (while)",
  starterCode: [
    "// Print een aftelling van 10 tot 0 op het scherm.",
    "// Gebruik een while-lus. Toon bij 0 het woord 'LANCERING!'.",
    "",
    "var teller = 10;",
    "while(teller > 0){",
    "  teller = teller - 1;",
    "  // Vul aan",
    "}"
  ].join('\n'), 
  evalOutput:
    "10\n9\n8\n7\n6\n5\n4\n3\n2\n1\n0\nLANCERING!"
},

{
  title: "2. Verzamel dorpen van Fred (while)",
  starterCode: [
    "// Vraag 5 keer een dorp aan de gebruiker en voeg toe aan een lijst.",
    "// Gebruik een while-lus. Toon op het einde: Dag mama, ik ben nog steeds op reis ...",
    "// De vijf dorpen: Bomal, Locronan, Rochefort-en-Terre, Saint-C√©neri-le-G√©rei, Montr√©sor, Pesmes", 
    "",
    "var lijst_tussenstops = '';",
    "var teller = 0;",
    "while(teller < 5){",
    "  // Vul aan",
    "}"
  ].join('\n'), 
    evalOutput: "Dag mama, ik ben nog steeds op reis in Frankrijk. Afgelopen dagen passeerde ik in: Bomal, Locronan, Rochefort-en-Terre, Saint-C√©neri-le-G√©rei, Montr√©sor, Pesmes"

},

{
  title: "3. Totale afstand berekenen (while)",
  starterCode: [
    "// Vraag 5 keer een afstand aan de gebruiker en tel alles op.",
    "// Gebruik een while-lus. Toon op het einde: De totale afstand die ik heb afgelegd is: ... km.",
    "// De afstanden zijn: 245.2km, 199.2km, 312km, 231km, 119.4km.",
    "",
    "var totaal = 0;",
    "var i = 1;",
    "while(i <= 5){",
    "  // Vul aan",
    "}"
  ].join('\n'), 
  evalOutput: "De totale afstand die ik heb afgelegd is: 1107.8 km."
},

{
  title: "4. Bosbrand Per Dag (while)",
  starterCode: [
    "// Bereken per dag (7 dagen) het afgebrande gebied.",
    "// Gebruik een while-lus. Print per dag: Op dag ... is er ... m¬≤ bos afgebrand.",
    "",
    "var dag = 1;",
    "var lengte = 329;",
    "var breedte = 277.32;",
    "while(dag <= 7){",
    "  // Vul aan",
    "}"
  ].join('\n'), 
  evalOutput:
    "Op dag 1 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 2 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 3 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 4 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 5 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 6 is er 91236.28 m¬≤ bos afgebrand.\n" +
    "Op dag 7 is er 91236.28 m¬≤ bos afgebrand."
},

{
  title: "5. Waarborg met Interest (while)",
  starterCode: [
    "// Bereken de waarborg voor elk jaar (5 jaar), groei 3% per jaar.",
    "// Gebruik een while-lus. Toon: Na jaar ... is de waarborg gegroeid tot ... euro.",
    "",
    "var maandhuur = 695;",
    "var waarborg = maandhuur * 3;",
    "var jaar = 1;",
    "while(jaar <= 5){",
    "  // Vul aan",
    "}"
  ].join('\n'), 
  evalOutput:
    "Na jaar 1 is de waarborg gegroeid tot 2147.55 euro.\n" +
    "Na jaar 2 is de waarborg gegroeid tot 2211.98 euro.\n" +
    "Na jaar 3 is de waarborg gegroeid tot 2278.34 euro.\n" +
    "Na jaar 4 is de waarborg gegroeid tot 2346.69 euro.\n" +
    "Na jaar 5 is de waarborg gegroeid tot 2417.09 euro."
},

{
  title: "6. Bevolkingsgroei Montpellier (while)",
  starterCode: [
    "// Bereken de bevolking van Montpellier voor 10 jaar met 3.1% groei.",
    "// Gebruik een while-lus. We starten in het jaar 2025.",
    "",
    "var bevolking = 295542;",
    "var jaar = 2025;",
    "while(jaar <= 2034){",
    "  // Vul aan",
    "}"
  ].join('\n'), 
  evalOutput:
    "In het jaar 2025 is de bevolking 304722 inwoners.\n" +
    "In het jaar 2026 is de bevolking 314178 inwoners.\n" +
    "In het jaar 2027 is de bevolking 323921 inwoners.\n" +
    "In het jaar 2028 is de bevolking 333959 inwoners.\n" +
    "In het jaar 2029 is de bevolking 344303 inwoners.\n" +
    "In het jaar 2030 is de bevolking 354964 inwoners.\n" +
    "In het jaar 2031 is de bevolking 365954 inwoners.\n" +
    "In het jaar 2032 is de bevolking 377282 inwoners.\n" +
    "In het jaar 2033 is de bevolking 388962 inwoners.\n" +
    "In het jaar 2034 is de bevolking 400999 inwoners."
},

{
  title: "7. Hittegolfalarm (while)",
  starterCode: [
    "// Vraag 5 temperaturen op, tel telkens wanneer de temp. > 25¬∞C.",
    "// Gebruik een while-lus. Toon 'Alarm: hittegolf!' als alle 5 temperaturen > 25, anders 'Geen hittegolf.'",
    "",
    "var alarmTeller = 0;",
    "var i = 1;",
    "while(i <= 5){",
    "  // Vul aan",
    "}"
  ].join('\n'), 
  evalOutput: "Alarm: hittegolf!"
},

{
  title: "8. Gemiddelde Score Kerstrapport (while)",
  starterCode: [
    "// Vraag 6 scores op en bereken het gemiddelde.",
    "// Gebruik een while-lus. Geef feedback afhankelijk van de gemiddelde score.",
    "// De scores: 88, 77, 93, 60, 70, 62.", 
    "",
    "var som = 0;",
    "var i = 1;",
    "while(i <= 6){",
    "  // Vul aan",
    "}"
  ].join('\n'), 
  evalOutput: "Het gemiddelde is 75.67"
}
    ]
  },
  {
    title: "Hoofdstuk 7: Figuren Plotten II",
    exercises: [
  // 1. Vierkant met for-lus
  {
    title: "1. Vierkant met for-lus",
    starterCode: [
      "// Teken een vierkant met zijden van 50px.",
      "// Gebruik een for-lus.",
      "showGrid(50);",
      "var zijde = 50;",
      "for(var teller = ...; teller < ...; teller...) {",
      "  ...",
      "  ...",
      "}",
    ].join('\n')
  },
  // 2. Driehoek met for-lus
  {
    title: "2. Gelijkzijdige Driehoek",
    starterCode: [
      "// Teken een driehoek met zijden van 70px met een for-lus.",
      "showGrid(50);",
      "var zijde = 70;",
      "for(var i = ...; i < ...; i...) {",
      "  ...",
      "  ...",
      "}",
    ].join('\n')
  },
  // 3. Meerdere vierkanten tekenen
  {
    title: "3. Drie Vierkanten",
    starterCode: [
      "// Teken drie vierkanten met zijden van 45px naast elkaar.",
      "showGrid(50);",
      "...",
      "for(...) {",
      "  for(...) {",
      "   ...",
      "  }",
      "  penUp();",
      "  ...",
      "  ...",
      "}",
    ].join('\n')
  },
  // 4. Cirkels tekenen met for-lus
  {
    title: "4. Cirkel met for-lus",
    starterCode: [
      "// Teken een cirkel door 360 keer vooruit te gaan en 1 graad te draaien.",
      "showGrid(50);",
      "setPenColour('purple');",
      "for(...) {",
      "  ...",
      "}",
    ].join('\n')
  },
  // 5. Trap tekenen met for-lus
  {
    title: "5. Trap met vijf treden",
    starterCode: [
      "// Teken een groene trap met vijf treden van 20px breed en 30px hoog.",
      "showGrid(50);",
      "  ...",
      "}",
    ].join('\n')
  },
  // 6. Spiraal tekenen met for-lus
  {
    title: "6. Spiraal tekenen",
    starterCode: [
      "// Teken een spiraal: elke lijn wordt 10px langer dan de vorige.",
      "showGrid(30);",
      "var lengte = 10;",
      "for(var i = 0; i < 8; i++) {",
      "  moveForward(lengte);",
      "  turnRight(45);",
      "  ... ",
      "}",
    ].join('\n')
  },
  // 7. Meerdere kleuren gebruiken in een lus
  {
    title: "7. Vierkanten in diverse kleuren",
    starterCode: [
      "// Teken drie vierkanten met kleur rood",
      "showGrid(50);",
    ].join('\n')
  },
  // 8. Lijndikte laten vari√´ren in een lus
  {
    title: "8. Lijndikte per vierkant",
    starterCode: [
      "// Teken drie vierkanten, elk met een andere lijndikte 30, 60, 90",
      "showGrid(50);",
      "for(var i = 1; i < 4; i++) {",
      "  var dikte = i * 30;",
      "  setLineWidth(...);",
    ].join('\n')
  },
  // 9. Figuren tekenen met while-lus
  {
    title: "9. Vierkanten met while-lus",
    starterCode: [
      "// Gebruik een while-lus om vierkanten te tekenen met zijden van 40, 30, 20 en 10px.",
      "// Herhaal dus ZOLANG de zijde >= 10 is.",
      "showGrid(50);",
      "var zijde = 40;",
      "while(zijde >= 10) {",
      "  ...",
      "}",
    ].join('\n')
  },
  // 10. Vierkanten tekenen in een spiraal
  {
    title: "10. Spiraal van vierkanten",
    starterCode: [
      "// Maak een variabele voor het aantal vierkanten.",
      "// Teken zoveel vierkanten.", 
      "// De vierkanten moeten in een spiraal staan.",
      "showGrid(50);",
    ].join('\n')
  },
  // 11. If-else in een lus
  {
    title: "11. Lijnkleur kiezen in een lus",
    starterCode: [
      "// Maak een variabele voor de lijnkleur. Teken vier vierkanten.",
      "// Als de kleur rood is, zet lijndikte op 5. Anders op 2.",
      "showGrid(50);",
    ].join('\n')
  },
  // 12. For + if-else if-else
  {
    title: "12. Kleur Kiezen + Selectie",
    starterCode: [
      "// Kies de kleur op basis van teller: 0 = 'orange', 1 = 'pink', anders 'purple'.",
      "// Teken drie vierkanten.",
      "showGrid(50);",
    ].join('\n')
  },
  // 13. Spiraal tekenen met while-lus en kleur veranderen
  {
    title: "13. Spiraal met veranderende kleur",
    starterCode: [
      "// Teken een spiraal. Bij elk stukje verandert de kleur tussen rood en blauw.",
      "showGrid(50);",
      "var lengte = 10;",
      "setPenColour(randomColour());",
      "while(lengte <= 500) {",
      "...",
    ].join('\n')
  },
  // 14. Annotatie in een lus
  {
    title: "14. Random Gevulde Cirkel",
    starterCode: [
      "// Teken een opgevulde cirkel.",
      "// Verander bij elke herhaling het kleur naar een random kleur",
      "showGrid(50);",
    ].join('\n')
  },
  // 15. Creatieve opdracht: combineren
  {
    title: "15. Creatieve Opdracht",
    starterCode: [
      "// Combineer: meerdere figuren, verschillende kleuren, if/else, for/while.",
      "// Zet overal waar mogelijk een variabele en schrijf tekst bij elk figuur.",
      "showGrid(50);"
    ].join('\n')
  }
]
},
];


    // -------------------- END EXERCISES -------------------------
// === STATE ===
let currentChapterIdx = 0;   // Welk hoofdstuk is actief?
let currentExerciseIdx = 0;  // Welke oefening binnen dat hoofdstuk is actief? 

// === METRICS: Pogingen + Tijd aan de Oefening ===============================
// Alles per oefening bewaren in localStorage, net zoals de code/voortgang.

let _workTimer = { running:false, lastStart:0, intervalId:null }; // interne timerstatus

// Hulpfunctie om consistente keys te maken per oefening:
function exKey(suffix){ 
  return `jsprog-${currentChapterIdx}-${currentExerciseIdx}-${suffix}`;
}

// -- Pogingen tellen --
function getPogingen(){ 
  return parseInt(localStorage.getItem(exKey('pogingen')) || '0', 10); 
}
function incPogingen(){ 
  const n = getPogingen() + 1;
  localStorage.setItem(exKey('pogingen'), String(n));
  return n;
}

// -- Werktijd (in milliseconden) --
function getWerkTijdMs(){ 
  return parseInt(localStorage.getItem(exKey('werkTijdMs')) || '0', 10); 
}
function setWerkTijdMs(ms){ 
  localStorage.setItem(exKey('werkTijdMs'), String(ms)); 
}
function addWerkTijd(ms){ 
  setWerkTijdMs(getWerkTijdMs() + ms); 
}

// Timer besturen: start/stop en UI updaten
function startWerkTimer(){
  // Start zodra de leerling effectief iets wijzigt (zie editor.on('change') hook)
  if (_workTimer.running) return;
  _workTimer.running = true;
  _workTimer.lastStart = Date.now();
  _workTimer.intervalId = setInterval(updateMetricsUI, 1000); // UI elke seconde bijwerken
}

function stopWerkTimer(){
  if(!_workTimer.running) return;
  const nu = Date.now();
  addWerkTijd(nu - _workTimer.lastStart); // cumuleren in localStorage
  _workTimer.running = false;
  _workTimer.lastStart = 0;
  clearInterval(_workTimer.intervalId);
  _workTimer.intervalId = null;
  updateMetricsUI(); // eindstand tonen
}

function resetWerkTimerState(){
  // Oproepen bij oefening wisselen; laat de opgeslagen tijd gewoon staan
  _workTimer.running = false;
  _workTimer.lastStart = 0;
  if (_workTimer.intervalId) clearInterval(_workTimer.intervalId);
  _workTimer.intervalId = null;
}

// Formatter voor het scherm/PDF
function formatDuur(ms){
  const s = Math.max(0, Math.floor(ms / 1000));
  const m = Math.floor(s / 60);
  const r = s % 60;
  return (m > 0 ? `${m}m ` : '') + `${r}s`;
}

// Klein UI-label rechts van "Canvas" toevoegen/actualiseren
let metricsEl = null;
function ensureMetricsEl(){
  if (metricsEl) return metricsEl;
  const header = document.querySelector('.canvas-header');
  metricsEl = document.createElement('span');
  metricsEl.id = 'metrics';
  metricsEl.style.fontFamily = 'monospace';
  metricsEl.style.marginLeft = '12px';
  header && header.appendChild(metricsEl);
  return metricsEl;
}

function updateMetricsUI(){
  const el = ensureMetricsEl();
  const basisMs = getWerkTijdMs();
  const liveMs  = _workTimer.running ? (Date.now() - _workTimer.lastStart) : 0;
  el.textContent = `Pogingen: ${getPogingen()} | Tijd: ${formatDuur(basisMs + liveMs)}`;
}

// Pauzeer bij focusverlies/tabwissel (geen spooktijd optellen)
window.addEventListener('blur', stopWerkTimer);
window.addEventListener('beforeunload', stopWerkTimer);
// Pauzeer ook bij tab-verbergen (sommige browsers sturen geen 'blur')
document.addEventListener('visibilitychange', () => {
  if (document.hidden) stopWerkTimer();
});
// === ELEMENTS ===
const opdrachtTekst = document.getElementById('opdracht-tekst');
const progressBar = document.getElementById('exercise-progress');
const chapterMenuList = document.getElementById('menu-chapters'); // UL in sidebar

// === RENDER CHAPTER MENU ===
function renderChapterMenu() {
  chapterMenuList.innerHTML = '';
  chapters.forEach((chapter, idx) => {
    const li = document.createElement('li');
    li.className = 'menu-chapter-item' + (idx === currentChapterIdx ? ' active' : '');
    li.textContent = chapter.title;
    li.tabIndex = 0; // accessibility: tab focusable
    li.setAttribute('role', 'button');
    li.onclick = () => switchChapter(idx);
    li.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') switchChapter(idx); };
    chapterMenuList.appendChild(li);
  });
}

// opslaan van de code van de gebruiker
function saveUserCode() {
  const key = `jsprog-${currentChapterIdx}-${currentExerciseIdx}`;
  const value = editor.getValue();
  try {
    localStorage.setItem(key, value);
  } catch (e) {
  }
}

// Progress bar / vooruitgang
function renderExerciseProgress() {
  progressBar.innerHTML = '';
  const exercises = chapters[currentChapterIdx].exercises;
  exercises.forEach((exercise, idx) => {
    const btn = document.createElement('button');
    btn.className = 'exercise-btn' + (idx === currentExerciseIdx ? ' current' : '');

    // NEW: Check for evaluation
    const evalKey = `jsprog-eval-${currentChapterIdx}-${idx}`;
    const evalStatus = localStorage.getItem(evalKey);
    if (evalStatus === "success") {
      btn.style.background = '#3dffd0'; // green
      btn.style.color = '#23272e';
    } else if (evalStatus === "fail") {
      btn.style.background = '#ff1744'; // red
      btn.style.color = '#fff';
    } else {
      btn.style.background = '';
      btn.style.color = '';
    }

    btn.textContent = idx + 1;
    btn.type = 'button';
    btn.title = exercise.title || `Oefening ${idx + 1}`;
    btn.onclick = () => switchExercise(idx);
    progressBar.appendChild(btn);
  });
}





// Inladen van een oefening
let isDirty = false;
function loadExercise() {
  const exercise = chapters[currentChapterIdx].exercises[currentExerciseIdx];
  opdrachtTekst.innerHTML = `<strong>${exercise.title || "(geen titel)"}</strong>`;
  
  const key = `jsprog-${currentChapterIdx}-${currentExerciseIdx}`;
  let savedCode = localStorage.getItem(key);
  if (savedCode !== null) {
    editor.setValue(savedCode);
  } else if (exercise.starterCode) {
    editor.setValue(exercise.starterCode);
  } else {
    editor.setValue('');
  }
  clearConsole();
  if (window.resetTurtle) window.resetTurtle();
  if (window.clearCanvas) window.clearCanvas();
  isDirty = false;
  stopWerkTimer();
  resetWerkTimerState();
  updateMetricsUI();
}
function showSavedToast() {
  // Geen meerdere pop-ups!
  if (document.getElementById('saved-toast')) return;
  const toast = document.createElement('div');
  toast.id = 'saved-toast';
  toast.textContent = "Opgeslagen!";
  toast.style.position = "fixed";
  toast.style.bottom = "32px";
  toast.style.right = "32px";
  toast.style.background = "#3dffd0";
  toast.style.color = "#23272e";
  toast.style.padding = "0.8em 1.2em";
  toast.style.borderRadius = "8px";
  toast.style.fontWeight = "bold";
  toast.style.boxShadow = "0 2px 12px rgba(0,0,0,0.10)";
  toast.style.zIndex = 3001;
  toast.style.opacity = "0";
  toast.style.transition = "opacity 0.25s";
  document.body.appendChild(toast);
  // Fade in
  setTimeout(() => { toast.style.opacity = "1"; }, 20);
  // Fade out and remove
  setTimeout(() => {
    toast.style.opacity = "0";
    setTimeout(() => { toast.remove(); }, 300);
  }, 900);
}

// SWITCH CHAPTER
function switchChapter(chapterIdx, exerciseIdx = 0) {
  confirmSwitch(() => {
    currentChapterIdx = chapterIdx;
    currentExerciseIdx = exerciseIdx;
    renderChapterMenu();
    renderExerciseProgress();
    loadExercise();
    isDirty = false; // Reset flag after switch
  });
}

// Wisselen van opdracht
function switchExercise(exIdx) {
  confirmSwitch(() => {
    currentExerciseIdx = exIdx;
    renderExerciseProgress();
    loadExercise();
    isDirty = false; // Reset flag after switch
  });
}

// --- BEGIN: Confirm Modal Promise-based Functie ---
window.confirmModal = function(message) {
  return new Promise((resolve) => {
    const modal = document.getElementById('confirm-modal');
    const msgDiv = document.getElementById('confirm-modal-msg');
    const okBtn = document.getElementById('confirm-modal-ok');
    const cancelBtn = document.getElementById('confirm-modal-cancel');

    // Toon de modal en stel het bericht in
    msgDiv.textContent = message;
    modal.style.display = "flex";

    // Opruim-functie voor na klikken of sluiten
    function cleanup(result) {
      modal.style.display = "none";
      okBtn.removeEventListener('click', onOk);
      cancelBtn.removeEventListener('click', onCancel);
      document.removeEventListener('keydown', onKeyDown);
      resolve(result);
    }

    // Handler voor OK-knop
    function onOk() { cleanup(true); }
    // Handler voor Annuleren-knop
    function onCancel() { cleanup(false); }

    okBtn.addEventListener('click', onOk);
    cancelBtn.addEventListener('click', onCancel);

    // Ondersteuning voor ESC- of Enter-toets
    function onKeyDown(e) {
      if (e.key === "Escape") cleanup(false);
      if (e.key === "Enter") cleanup(true);
    }
    document.addEventListener('keydown', onKeyDown);

    // Sluiten bij klikken buiten het modal-venster
    modal.onclick = function(e) {
      if (e.target === modal) cleanup(false);
    };
  });
};
// --- EINDE: Confirm Modal ---

  
function confirmSwitch(callback) {
  if (!isDirty) {
    callback();
    return;
  }
  window.confirmModal(
    "Je hebt jouw code nog niet uitgevoerd of opgeslagen. Weet je zeker dat je wilt doorgaan? Je wijzigingen gaan verloren."
  ).then((proceed) => {
    if (proceed) callback();
    // else: doe niets
  });
}




// --- INIT ---
document.addEventListener("DOMContentLoaded", function() {
  renderChapterMenu();
  renderExerciseProgress();
  loadExercise();
});

    // CodeMirror setup
    let editor = CodeMirror(document.getElementById('code-editor'), {
      value: chapters[0].exercises[0].starterCode,
      mode: "javascript",
      lineNumbers: true,
      theme: "default",
      tabSize: 2,
      autofocus: true,
    });
    editor.on('change', function() {
  isDirty = true;
  const key = `jsprog-${currentChapterIdx}-${currentExerciseIdx}`;
  localStorage.setItem(key, editor.getValue());
  startWerkTimer();          // Nederlands: start de werktijd-timer bij eerste wijziging
  updateMetricsUI();         // Nederlands: toon actuele pogingen+tijd
});



    // Console output logic
    const consoleDiv = document.getElementById('console-output');
    function clearConsole() { consoleDiv.textContent = ''; }
    function appendToConsole(msg) { consoleDiv.textContent += msg + "\n"; }
    (function(){
  const oldLog = console.log;
  console.log = function(...args) {
    oldLog.apply(console, args);

    // ---- Vang uitvoer op voor evaluatie ----
    let str = args.map(String).join(" ");
    capturedOutput += str + "\n";      // <-- Dit is de extra lijn!

    appendToConsole(str);
  };
})();

    // Help modal tonen/verbergen
    const helpModal = document.getElementById('help-modal');
    document.getElementById('help-btn').onclick = function() {
      helpModal.style.display = "flex";
    };
    document.getElementById('close-help').onclick = function() {
      helpModal.style.display = "none";
    };
    helpModal.onclick = function(e) {
      if (e.target === helpModal) helpModal.style.display = "none";
    };

    // Dynamisch kleuren tonen in overlay uit rgbcolor.js
    function renderSwatches() {
      let simple_colors = null;
      if (typeof RGBColor === "function") {
        let match = RGBColor.toString().match(/var\s+simple_colors\s*=\s*({[\s\S]+?});/);
        if (match) {
          try { simple_colors = eval('(' + match[1] + ')'); } catch (e) {}
        }
        if (!simple_colors && RGBColor.simple_colors) simple_colors = RGBColor.simple_colors;
      }
      if (!simple_colors) simple_colors = {red:'ff0000',blue:'0000ff',green:'008000',black:'000000',white:'ffffff'};

      const MAX_COLORS = 32;
      let names = Object.keys(simple_colors).slice(0, MAX_COLORS);

      let swatchesHTML = '';
      for (const colorName of names) {
        const hex = '#' + simple_colors[colorName];
        const r = parseInt(simple_colors[colorName].substring(0,2), 16);
        const g = parseInt(simple_colors[colorName].substring(2,4), 16);
        const b = parseInt(simple_colors[colorName].substring(4,6), 16);
        const rgbString = `rgb(${r},${g},${b})`;
        swatchesHTML += `
          <div class="swatch-container">
          <div class="swatch" style="background:${hex};"></div>
          <div class="label">${colorName}<br>
            <span class="rgb">${rgbString}</span>
          </div>
        </div>
        `;

      }
      document.getElementById('dynamic-color-swatches').innerHTML = swatchesHTML;
    }
    document.addEventListener("DOMContentLoaded", renderSwatches);

    // Dark mode toggle
    document.getElementById('toggle-theme').onclick = function() {
      document.body.classList.toggle('dark');
    };

// Export naar PDF
document.getElementById('export-pdf').onclick = function() {
  document.getElementById('pdf-modal').style.display = 'flex';
  document.getElementById('modal-naam').value = '';
  document.getElementById('modal-klas').value = '';
  document.getElementById('modal-oefening').value = '';
  document.getElementById('modal-naam').focus();
};

// Close modal logic (X button or click outside)
document.getElementById('close-pdf-modal').onclick = function() {
  document.getElementById('pdf-modal').style.display = 'none';
};
document.getElementById('pdf-modal').onclick = function(e) {
  if (e.target === this) this.style.display = 'none';
};
// Brand colours voor de opmaak van de PDF: 
  const COLOR_PURPLE = [82, 0, 255];    // #5200FF
  const COLOR_GREEN = [61, 255, 208];   // #3DFFD0
  const COLOR_WHITE = [255, 255, 255];  // #FFFFFF
  
// Maak een PDF nadat de gebruiker op OK drukt in de modal: 
document.getElementById('modal-ok').onclick = async function() {
  const naam = document.getElementById('modal-naam').value.trim();
  const klas = document.getElementById('modal-klas').value.trim();
  let oefening = document.getElementById('modal-oefening').value.trim();
  if (!naam || !klas) {
    alert("Gelieve je naam en klas in te vullen.");
    return;
  }
  if (!oefening) {
    oefening = chapters[currentChapterIdx].exercises[currentExerciseIdx].title || "(geen titel)";
  }
  document.getElementById('pdf-modal').style.display = 'none';

  // Data for evaluation/status
  const evalKey = `jsprog-eval-${currentChapterIdx}-${currentExerciseIdx}`;
  const evalStatus = localStorage.getItem(evalKey);
  const exercise = chapters[currentChapterIdx].exercises[currentExerciseIdx];
  const expectedOutput = exercise.evalOutput || "";

  // Canvas capture
  const canvas = document.getElementById('turtlecanvas');
  const canvasImg = await html2canvas(canvas, {
    backgroundColor: null,
    scale: 2
  }).then(cnv => cnv.toDataURL('image/png'));

  // PDF setup
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });
  const pageHeight = pdf.internal.pageSize.height;
  const margin = 36, contentWidth = 520;
  let y = margin;

  // Font en stijlen tekst:
  function setBodyFont()   { pdf.setFont('helvetica', 'normal'); pdf.setFontSize(12); }
  function setHeaderFont() { pdf.setFont('helvetica', 'bold'); pdf.setFontSize(18); }
  function setLabelFont()  { pdf.setFont('helvetica', 'bold'); pdf.setFontSize(13); }
  function setCodeFont()   { pdf.setFont('courier', 'normal'); pdf.setFontSize(10); }

  function ensureRoom(heightNeeded) {
    if (y + heightNeeded > pageHeight - margin) {
      pdf.addPage();
      y = margin;
    }
  }

  function addMultilineSection(label, contentLines, color=COLOR_PURPLE, code=false) {
    pdf.setTextColor(...color); setLabelFont();
    pdf.text(label, margin, y); y += 16;
    if (code) { setCodeFont(); }
    else      { setBodyFont(); }
    pdf.setTextColor(0, 0, 0); // body text = black
    const lineHeight = code ? 13 : 14;
    for (let i = 0; i < contentLines.length; ) {
      let linesFit = Math.floor((pageHeight - y - margin) / lineHeight);
      if (linesFit < 1) { pdf.addPage(); y = margin; continue; }
      let linesThisPage = contentLines.slice(i, i + linesFit);
      pdf.text(linesThisPage, margin, y);
      i += linesFit;
      y += linesThisPage.length * lineHeight;
      if (i < contentLines.length) { pdf.addPage(); y = margin; }
    }
    y += 10;
  }

  // Header
  pdf.setTextColor(...COLOR_PURPLE); setHeaderFont();
  pdf.text('JavaScript in de Klas ‚Äì Oefening', margin, y); y += 28;
  pdf.setTextColor(0, 0, 0); setBodyFont();
  pdf.text(`Naam: ${naam}`, margin, y); y += 18;
  pdf.text(`Klas: ${klas}`, margin, y); y += 18;
  pdf.text(`Oefening: ${oefening}`, margin, y); y += 30;

  // Opdracht
  let opdrachtTekst = document.getElementById('opdracht-tekst').textContent;
  let opdrachtLines = pdf.splitTextToSize(opdrachtTekst, contentWidth);
  pdf.setTextColor(...COLOR_PURPLE); setLabelFont();
  pdf.text("Opdracht:", margin, y); y += 20;
  pdf.setTextColor(0, 0, 0); setBodyFont();
  pdf.text(opdrachtLines, margin, y); y += opdrachtLines.length * 14 + 18;

  // Code
  let code = editor.getValue();
  let codeLines = pdf.splitTextToSize(code, contentWidth);
  addMultilineSection("Code:", codeLines, COLOR_PURPLE, true);

  // Output
  let consoleText = document.getElementById('console-output').textContent;
  let outputLines = pdf.splitTextToSize(consoleText || "(geen uitvoer)", contentWidth);
  addMultilineSection("Console-uitvoer:", outputLines, COLOR_PURPLE, true);

// Status oefening + metacognitieve metrics (pogingen & tijd)
pdf.setTextColor(...COLOR_PURPLE); setLabelFont();
pdf.text("Status oefening:", margin, y); y += 16;

pdf.setTextColor(0, 0, 0); setBodyFont();

// 1) Status-tekst zoals vroeger
let statusText;
if (evalStatus === "success") statusText = "Oefening correct";
else if (evalStatus === "fail") statusText = "Uitgevoerd, maar niet correct";
else statusText = "Niet uitgevoerd";
pdf.text(statusText, margin, y); y += 16;

// 2) Waarden rechtstreeks uit je helpers of, als fallback, uit localStorage
//    (Zo blijft het werken als je functienamen ooit wijzigt)
const pogingen = (typeof getPogingen === 'function')
  ? getPogingen()
  : parseInt(localStorage.getItem(`jsprog-${currentChapterIdx}-${currentExerciseIdx}-pogingen`) || '0', 10);

const tijdMs = (typeof getWerkTijdMs === 'function')
  ? getWerkTijdMs()
  : parseInt(localStorage.getItem(`jsprog-${currentChapterIdx}-${currentExerciseIdx}-werkTijdMs`) || '0', 10);

// 3) Gebruik dezelfde formatter als in de UI indien beschikbaar
function _fmt(ms){
  if (typeof formatDuur === 'function') return formatDuur(ms);
  const s = Math.max(0, Math.floor((ms || 0)/1000));
  const m = Math.floor(s/60), r = s % 60;
  return (m > 0 ? `${m}m ` : '') + `${r}s`;
}

// 4) Extra regels in het rapport
pdf.text(`Pogingen: ${pogingen}`, margin, y); y += 16;
pdf.text(`Tijd besteed: ${_fmt(tijdMs)}`, margin, y); y += 24;


  // Correctiesleutel indien beschikbaar: 
  if (expectedOutput && expectedOutput.length > 0) {
    let expectedLines = pdf.splitTextToSize(expectedOutput, contentWidth);
    addMultilineSection("Verwachte uitvoer:", expectedLines, COLOR_PURPLE, true);
  }

  // Canvas: 
  const imgHeight = 210, imgWidth = 210;
  ensureRoom(imgHeight + 40);
  pdf.setTextColor(...COLOR_PURPLE); setLabelFont();
  pdf.text("Canvas:", margin, y); y += 10;
  pdf.addImage(canvasImg, 'PNG', margin, y, imgWidth, imgHeight); y += imgHeight + 20;

// Feedback:
ensureRoom(250); // More space for larger rows
pdf.setTextColor(...COLOR_PURPLE); setLabelFont();
pdf.text("Beoordeling & Feedback leerkracht:", margin, y); y += 18;

// Table layout constants
const tableWidth = 520;
const criteriumColWidth = 160;
const scoreColWidth = 54;
const feedbackColWidth = tableWidth - criteriumColWidth - scoreColWidth;
const startX = margin;
const col1 = startX + criteriumColWidth;
const col2 = col1 + scoreColWidth;
const headerH = 28;
const rowH = 44; // Taller rows

// Draw table outline
pdf.setDrawColor(...COLOR_PURPLE); 
pdf.setLineWidth(0.8);
pdf.rect(startX, y, tableWidth, headerH + 5 * rowH, 'S');

// Draw header background (purple rectangle)
pdf.setFillColor(...COLOR_PURPLE);
pdf.rect(startX, y, tableWidth, headerH, 'F'); // Fill only header row

// Table headers: bold & white
pdf.setTextColor(255, 255, 255);
pdf.setFont('helvetica', 'bold');
pdf.setFontSize(13);
pdf.text("Criterium", startX + 8, y + 19);
pdf.text("Score", col1 + 12, y + 19);
pdf.text("Feedback", col2 + 12, y + 19);

// Vertical lines
pdf.setDrawColor(...COLOR_PURPLE);
pdf.line(col1, y, col1, y + headerH + 5 * rowH);
pdf.line(col2, y, col2, y + headerH + 5 * rowH);

// Horizontal lines and row labels
pdf.setFont('helvetica', 'normal');
pdf.setFontSize(12);
const criteria = ["Functioneel", "Leesbaar", "Programmeerconcept", "Wiskundeconcept", "Creativiteit"];
for (let i = 0; i < criteria.length; i++) {
  const rowY = y + headerH + i * rowH;
  // Row line
  pdf.line(startX, rowY, startX + tableWidth, rowY);
  // Row label (criterium)
  pdf.setTextColor(...COLOR_PURPLE);
  pdf.setFont('helvetica', 'bold');
  pdf.text(criteria[i], startX + 8, rowY + 26);
  
}
y += headerH + 5 * rowH + 20; // plaats tussen de tabel en alg. feedback

// "Algemene feedback" bold and purple
pdf.setTextColor(...COLOR_PURPLE);
pdf.setFont('helvetica', 'bold');
pdf.setFontSize(13);
pdf.text("Algemene feedback:", startX + 8, y);

// Reset text color/font for any further text
pdf.setTextColor(0, 0, 0);
pdf.setFont('helvetica', 'normal');
pdf.setFontSize(12);




  // Bestand opslaan: 
  function sanitize(s) { return s.replace(/[^a-zA-Z0-9_\-]/g, "_"); }
  const fname = `${sanitize(naam)}-${sanitize(klas)}-${sanitize(oefening)}.pdf`;
  pdf.save(fname);
};


// === Co√∂rdinaten correct berekenen (border + CSS-schaal + zoom/pan) ===
(function () {
  const coordsSpan = document.getElementById('coords');
  const canvas = document.getElementById('turtlecanvas');

  // Hulpfunctie: lees daadwerkelijke border-diktes
  function getBorderSizes(el) {
    const s = getComputedStyle(el);
    return {
      left:   parseFloat(s.borderLeftWidth)   || 0,
      right:  parseFloat(s.borderRightWidth)  || 0,
      top:    parseFloat(s.borderTopWidth)    || 0,
      bottom: parseFloat(s.borderBottomWidth) || 0
    };
  }

  canvas.addEventListener("mousemove", function (event) {
    const rect = canvas.getBoundingClientRect();
    const b = getBorderSizes(canvas);

    // 1) Cursorpositie in CSS-pixels binnen de CONTENT (border aftrekken)
    const cssX = event.clientX - rect.left - b.left;
    const cssY = event.clientY - rect.top  - b.top;

    // 2) Schaal CSS-pixels ‚Üí canvas-pixels (interne bitmap)
    const contentCssWidth  = rect.width  - b.left - b.right;
    const contentCssHeight = rect.height - b.top  - b.bottom;
    const scaleX = canvas.width  / contentCssWidth;
    const scaleY = canvas.height / contentCssHeight;

    const cx = cssX * scaleX;  // canvas-px
    const cy = cssY * scaleY;  // canvas-px

    // 3) Canvas-px ‚Üí wereldco√∂rdinaten (0,0 in midden; Y omhoog positief)
    const centerX = canvas.width  / 2;
    const centerY = canvas.height / 2;

    // Let op: panX/panY en zoom komen uit jouw globale staat
    const worldX = (cx - centerX - panX) / zoom;
    const worldY = (centerY - cy - panY) / zoom;

    // 4) Toon afgeronde waarden
    coordsSpan.textContent = `X:${Math.round(worldX)} Y:${Math.round(worldY)}`;
  });

  canvas.addEventListener("mouseleave", function () {
    coordsSpan.textContent = "";
  });
})();

 

const menuTab = document.getElementById('menu-tab');
const courseMenu = document.getElementById('course-menu');
const closeMenu = document.getElementById('close-menu');

menuTab.onclick = (e) => {
  e.stopPropagation(); // Prevent document click
  if (courseMenu.classList.contains('open')) {
    courseMenu.classList.remove('open');
  } else {
    courseMenu.classList.add('open');
    courseMenu.focus();
  }
};

closeMenu.onclick = () => {
  courseMenu.classList.remove('open');
};

courseMenu.addEventListener('keydown', e => {
  if (e.key === 'Escape') courseMenu.classList.remove('open');
});
document.addEventListener('click', e => {
  if (
    courseMenu.classList.contains('open') &&
    !courseMenu.contains(e.target) &&
    e.target !== menuTab
  ) {
    courseMenu.classList.remove('open');
  }
});
 
document.getElementById('reset-progress').onclick = async function() {
  const proceed = await window.confirmModal(
    "Weet je zeker dat je alle voortgang en opgeslagen code wilt wissen?"
  );
  if (proceed) {
    Object.keys(localStorage).forEach(key => {
      if (key.startsWith("jsprog-")) localStorage.removeItem(key);
    });
    renderExerciseProgress();
    loadExercise();
  }
};

// Functie om de error messages beter te maken voor de leerlingen: 
function translateError(message) {
  if (message.includes("Unexpected identifier")) {
    return "Onverwacht woord in de code. Mogelijk een typfout of een ontbrekende komma. Controleer je regels.";
  }
  if (message.includes("is not defined")) {
    return "Variabele is niet gekend. Heb je de variabele gedeclareerd met 'var'? Of een typfout?";
  }
  if (message.includes("missing ) after argument list")) {
    return "Je mist een haakje. Tel je ( en ) even na!";
  }
  if (message.includes("Unexpected token }")) {
    return "Onverwachte '}'. Mogelijk te veel of te weinig accolades gebruikt.";
  }
  if (message.includes("not a function")) {
    return "Je probeert iets als functie te gebruiken, maar dat klopt niet. Typfout in de functienaam?";
  }
  if (message.includes("Cannot read property")) {
    return "Je probeert iets te gebruiken dat niet bestaat. Controleer je objecten en variabelen.";
  }
  if (message.includes("Maximum call stack")) {
    return "Je code zit mogelijk in een oneindige lus. Controleer je lussen!";
  }
  if (message.includes("Invalid or unexpected token")) {
    return "Er staat een teken in je code dat JavaScript niet herkent. Dit kan een typefout zijn, een vergeten haakje, puntkomma of een vreemd teken.";
  }
  if (message.includes("Lus zonder accolades")) {
  return "Je gebruikt een lus zonder { }. Zet je lus-inhoud tussen accolades: { ... }";
  }
if (message.includes("mogelijk oneindige lus")) {
  return "Je code lijkt vast te zitten in een (bijna) oneindige lus. Controleer de lusvoorwaarde en zorg dat de variabelen veranderen.";
}
  // Standaard: originele Engelse boodschap
  return message;
}

// Evalueren van oefeningen en console uitvoer checken:
// --- Opties voor normalisatie van tekst ---
const _DEFAULT_NORM_OPTS = {
  caseInsensitive: true,   // hoofdletter-ongevoelig vergelijken
  trim: true,              // randspaties verwijderen
  collapseSpaces: true,    // meerdere spaties ‚Üí √©√©n spatie
  removePunctuation: false,// standaard interpunctie behouden
  decimalCommaToDot: true  // "12,34" ‚Üí "12.34" (handig voor Benelux)
};

// Regels die we negeren uit de console (bv. debug)
const _IGNORE_LINE_PATTERNS = [
  /^debug output:/i,
  /^\s*opgeslagen!$/i
];

// --- Helpers ---
function _shouldIgnoreLine(line) {
  return _IGNORE_LINE_PATTERNS.some(rx => rx.test(line));
}

function _normalizeText(s, opts = _DEFAULT_NORM_OPTS) {
  let t = s ?? "";
  if (opts.decimalCommaToDot) {
    // Vervang komma-decimaalvorm in getallen (12,34 ‚Üí 12.34)
    t = t.replace(/(\d),(\d)/g, '$1.$2');
  }
  if (opts.trim) t = t.trim();
  if (opts.collapseSpaces) t = t.replace(/\s+/g, ' ');
  if (opts.removePunctuation) t = t.replace(/[.,;:!?‚Ä¶‚Äì‚Äî\-]/g, '');
  if (opts.caseInsensitive) t = t.toLowerCase();
  return t;
}

function _extractNumbers(s) {
  // Herken ook "12,34" als 12.34
  const norm = (s ?? "").replace(/(\d),(\d)/g, '$1.$2');
  const matches = norm.match(/-?\d+(?:\.\d+)?/g) || [];
  return matches.map(parseFloat);
}

function _nearlyEqual(a, b, eps = 0.01) {
  return Math.abs(a - b) <= eps;
}

// Vergelijk regel-voor-regel met toleranties op getallen.
// Geeft { ok:boolean, info:string } terug.
function _looseCompare(expectedRaw, userRaw, opts = {}) {
  const linesE = (expectedRaw ?? '')
    .split(/\r?\n/)
    .map(l => l.replace(/\u00A0/g, ' ')) // NBSP ‚Üí spatie
    .map(l => l.trim())
    .filter(l => l.length > 0);

  const linesU = (userRaw ?? '')
    .split(/\r?\n/)
    .map(l => l.replace(/\u00A0/g, ' '))
    .map(l => l.trim())
    .filter(l => l.length > 0 && !_shouldIgnoreLine(l));

  if (linesE.length !== linesU.length) {
    return { ok: false, info: `Regelaantal wijkt af (verwacht ${linesE.length}, gekregen ${linesU.length}).` };
  }

  for (let i = 0; i < linesE.length; i++) {
    const e = linesE[i];
    const u = linesU[i];

    const numsE = _extractNumbers(e);
    const numsU = _extractNumbers(u);

    // Als beide regels getallen bevatten met gelijke telling ‚Üí vergelijk numeriek + resttekst
    if (numsE.length > 0 && numsE.length === numsU.length) {
      const tol = opts.tolerance ?? 0.01;
      for (let j = 0; j < numsE.length; j++) {
        if (!_nearlyEqual(numsE[j], numsU[j], tol)) {
          return { ok: false, info: `Getal op regel ${i + 1} wijkt af (verwacht ${numsE[j]}, kreeg ${numsU[j]}).` };
        }
      }
      // Vergelijk niet-numerieke delen losser
      const eText = _normalizeText(e.replace(/-?\d+(?:\.\d+)?/g, ''), opts);
      const uText = _normalizeText(u.replace(/-?\d+(?:\.\d+)?/g, ''), opts);
      if (eText !== uText) {
        return { ok: false, info: `Tekst op regel ${i + 1} wijkt af (we negeren spaties/case/komma-punt).` };
      }
    } else {
      // Geen getallen: losse tekstvergelijking
      const eN = _normalizeText(e, opts);
      const uN = _normalizeText(u, opts);
      if (eN !== uN) {
        return { ok: false, info: `Regel ${i + 1} wijkt af.` };
      }
    }
  }
  return { ok: true, info: 'Uitvoer komt overeen.' };
}

// --- Optionele per-oefening evaluatiemodi ---
// Voorbeeld in een oefening:
// eval: { type: 'numbers', expected: [826.80, 292.32, 54.4], tolerance: 0.1 }
// eval: { type: 'regex', pattern: "de\\s+toegangsprijs\\s+is\\s+\\d+(?:[.,]\\d+)?\\s+euro\\.?$", flags: "i" }
// eval: { type: 'contains', substrings: ["goedemorgen", "mevr.", "deleye"] }

function _evalByMode(exercise, userRaw) {
  const cfg = exercise.eval;
  if (!cfg || !cfg.type) return null;

  const raw = (userRaw ?? '').replace(/(\d),(\d)/g, '$1.$2');

  if (cfg.type === 'numbers') {
    const numsU = _extractNumbers(raw);
    const numsE = (cfg.expected || []).map(Number);
    const tol = cfg.tolerance ?? 0.01;

    if (cfg.orderInsensitive) {
      const a = [...numsU].sort((x,y)=>x-y);
      const b = [...numsE].sort((x,y)=>x-y);
      if (a.length !== b.length) return { ok:false, info:`Aantal getallen wijkt af (verwacht ${b.length}, kreeg ${a.length}).` };
      for (let i=0;i<a.length;i++) if (!_nearlyEqual(a[i], b[i], tol)) {
        return { ok:false, info:`Getallen wijken af (tolerantie ${tol}).` };
      }
      return { ok:true, info:'Getallen kloppen (volgorde genegeerd).' };
    } else {
      if (numsU.length !== numsE.length) return { ok:false, info:`Aantal getallen wijkt af (verwacht ${numsE.length}, kreeg ${numsU.length}).` };
      for (let i=0;i<numsE.length;i++) if (!_nearlyEqual(numsU[i], numsE[i], tol)) {
        return { ok:false, info:`Getal #${i+1} wijkt af (verwacht ${numsE[i]}, kreeg ${numsU[i]}).` };
      }
      return { ok:true, info:'Getallen kloppen (op volgorde).' };
    }
  }

  if (cfg.type === 'regex') {
    const re = new RegExp(cfg.pattern, cfg.flags || 'i'); // standaard case-insensitive
    const ok = re.test(raw.trim());
    return { ok, info: ok ? 'Patroon komt overeen.' : 'Tekst voldoet niet aan het patroon.' };
  }

  if (cfg.type === 'contains') {
    const hay = raw.toLowerCase();
    const missing = (cfg.substrings || []).filter(s => !hay.includes(String(s).toLowerCase()));
    if (missing.length === 0) return { ok:true, info:'Alle vereiste woorden/fragmenten aanwezig.' };
    return { ok:false, info:`Ontbreekt: ${missing.join(', ')}` };
  }

  return null;
}

// ============= Hoofdfunctie =============
function evaluateExercise() {
  const ex = chapters[currentChapterIdx].exercises[currentExerciseIdx];

  // Geen sleutel ‚Üí niet evalueerbaar
  if (!ex || (!ex.evalOutput && !ex.eval)) {
    window._lastEvalInfo = 'Geen evaluatiesleutel voor deze oefening.';
    return null;
  }

  // Ruwe uitvoer ophalen (we normaliseren later)
  const userRaw = (typeof capturedOutput === 'string') ? capturedOutput : String(capturedOutput || '');

  // 1) Per-oefening modus heeft voorrang (indien aanwezig)
  const modeRes = _evalByMode(ex, userRaw);
  if (modeRes) {
    window._lastEvalInfo = modeRes.info;
    return modeRes.ok;
  }

  // 2) Standaard: losse line-by-line vergelijking met getal-tolerantie
  const loose = _looseCompare(ex.evalOutput || '', userRaw, {
    ..._DEFAULT_NORM_OPTS,
    tolerance: 0.01,        // pas aan indien nodig
    removePunctuation: false
  });

  window._lastEvalInfo = loose.info;
  return loose.ok;
}
  
  
// Toast indicator na de output checker: 
function showEvalFeedback(isCorrect) {
  const progressBtns = document.querySelectorAll('.exercise-btn');
  if (!progressBtns[currentExerciseIdx]) return;

  if (isCorrect === null) {
    progressBtns[currentExerciseIdx].style.background = '';
    progressBtns[currentExerciseIdx].style.color = '';
    return;
  }

  const extraInfo = window._lastEvalInfo || '';
  const exercise = chapters[currentChapterIdx].exercises[currentExerciseIdx];

  if (isCorrect) {
    progressBtns[currentExerciseIdx].style.background = '#3dffd0';
    progressBtns[currentExerciseIdx].style.color = '#23272e';
    // üá≥üá± duidelijke feedback
    showToast("‚úÖ Goed gedaan! " + (extraInfo || "Je output is correct."), true);
  } else {
    progressBtns[currentExerciseIdx].style.background = '#ff1744';
    progressBtns[currentExerciseIdx].style.color = '#fff';
    const expected = exercise.evalOutput ? ("\n\nVerwachte uitvoer:\n" + exercise.evalOutput) : "";
    showToast("‚ùå Niet helemaal goed. " + (extraInfo || "") + expected, false);
  }
}
// Voeg toe aan je script
function showToast(message, success) {
  let toast = document.getElementById('eval-toast');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'eval-toast';
    toast.style.position = 'fixed';
    toast.style.bottom = '42px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.padding = '1em 2em';
    toast.style.fontSize = '1.1em';
    toast.style.fontWeight = 'bold';
    toast.style.borderRadius = '12px';
    toast.style.zIndex = 9999;
    toast.style.boxShadow = '0 4px 16px rgba(0,0,0,0.16)';
    toast.style.maxWidth = '85vw';
    document.body.appendChild(toast);
  }
  toast.textContent = message;
  toast.style.background = success ? '#e6fff8' : '#fff0f0';
  toast.style.color = success ? '#04695c' : '#c81c1c';
  toast.style.display = 'block';
  clearTimeout(window.evalToastTimeout);
  window.evalToastTimeout = setTimeout(() => {
    toast.style.display = 'none';
  }, 4000);
}

function customPrompt(question, callback) {
  const modal = document.getElementById('custom-modal');
  document.getElementById('modal-body').innerHTML = `<label>${question}</label><br><input type="text" id="modal-input" style="width:100%;margin-top:1em;">`;
  document.getElementById('modal-actions').innerHTML =
    `<button id="modal-ok">OK</button>`;
  modal.style.display = 'flex';

  // Close met X
  document.getElementById('modal-close').onclick = () => modal.style.display = 'none';

  // Bevestig
  document.getElementById('modal-ok').onclick = function() {
    const val = document.getElementById('modal-input').value;
    modal.style.display = 'none';
    callback(val);
  };
  // Enter = OK
  document.getElementById('modal-input').onkeydown = function(e) {
    if (e.key === "Enter") document.getElementById('modal-ok').click();
  };
  document.getElementById('modal-input').focus();
}

function customConfirm(question, callback) {
  const modal = document.getElementById('custom-modal');
  document.getElementById('modal-body').innerHTML = `<p>${question}</p>`;
  document.getElementById('modal-actions').innerHTML =
    `<button id="modal-yes">Ja</button> <button id="modal-no">Nee</button>`;
  modal.style.display = 'flex';
  document.getElementById('modal-close').onclick = () => { modal.style.display = 'none'; callback(false); };
  document.getElementById('modal-no').onclick = () => { modal.style.display = 'none'; callback(false); };
  document.getElementById('modal-yes').onclick = () => { modal.style.display = 'none'; callback(true); };
}

  document.getElementById('close-pdf-modal').onclick = function() {
    document.getElementById('pdf-modal').style.display = 'none';
  };
    
document.getElementById('export-pdf').onclick = function() {
  document.getElementById('pdf-modal').style.display = 'flex';
  document.getElementById('modal-naam').value = '';
  document.getElementById('modal-klas').value = '';
  document.getElementById('modal-oefening').value = '';
  document.getElementById('modal-naam').focus();
};

// --- Modalgebaseerde ask()-functie want SEB Compatibility ---
  // Hiermee kan je: var naam = ask("Vraag?");
  window.ask = function(boodschap) {
    return new Promise((resolve) => {
      // Haal modal-onderdelen op
      const modal = document.getElementById('ask-modal');
      const msgDiv = document.getElementById('ask-modal-msg');
      const input = document.getElementById('ask-modal-input');
      const okBtn = document.getElementById('ask-modal-ok');

      // Toon de boodschap en maak inputveld leeg
      msgDiv.textContent = boodschap;
      input.value = '';
      modal.style.display = 'flex';
      input.focus();

      // Sluit modal en verwijder event listeners
      function cleanup() {
        modal.style.display = 'none';
        okBtn.removeEventListener('click', onOk);
        input.removeEventListener('keydown', onEnter);
      }

      // Afhandelen bij OK-knop
      function onOk() {
        cleanup();
        resolve(input.value); // Geef de waarde terug aan de code
      }

      // Afhandelen bij Enter-toets
      function onEnter(e) {
        if (e.key === 'Enter') onOk();
      }

      okBtn.addEventListener('click', onOk);
      input.addEventListener('keydown', onEnter);
    });
  };
  
// --- Loop guard instrumentation (iteration + time budget) ---
function applyLoopGuard(source, options = {}) {
  const MAX_ITERS = options.maxIters ?? 200000;  // stop after N iterations
  const MAX_MS    = options.maxMs   ?? 2000;     // or after N milliseconds

  // Optional escape hatch per exercise:
  // if the student puts /* @no-guard */ at the top, skip guarding
  if (/^\s*\/\*\s*@no-guard\s*\*\//.test(source)) return source;

  // EDU: to keep instrumentation simple + robust, require braces on loop bodies.
  // This avoids tricky single-statement loops like: while (x<10) moveForward(1);
  const bracelessLoop = /(for|while)\s*\([^)]*\)\s*(?!\{)/;
  if (bracelessLoop.test(source)) {
    throw new Error("Lus zonder accolades gedetecteerd. Gebruik { } rond de code in je for/while-lus.");
  }

  // Prelude defines __tick() which enforces the limits
  const prelude = `
    const __GUARD_MAX_ITERS = ${MAX_ITERS};
    const __GUARD_MAX_MS = ${MAX_MS};
    let __guard_iters = 0;
    const __guard_start = Date.now();
    function __tick() {
      __guard_iters++;
      // check time every ~1000 ticks
      if ((__guard_iters & 1023) === 0) {
        if (Date.now() - __guard_start > __GUARD_MAX_MS) {
          throw new Error("Tijdslimiet overschreden (mogelijk oneindige lus).");
        }
      }
      if (__guard_iters > __GUARD_MAX_ITERS) {
        throw new Error("Te veel iteraties (mogelijk oneindige lus).");
      }
    }
  `;

  // We inject __tick in:
  //  - while(...) { ... }    => call in condition + at body start
  //  - for(init;cond;step) { => call in condition + at body start
  //  - for(;;) {             => body start
  //  - do { ... } while(...); => call at body start
  let code = source;

  // do { ... } while(...);
  code = code.replace(/do\s*\{/g, match => `${match} __tick(); `);

  // while (...) {
  code = code.replace(
    /while\s*\(([^)]*)\)\s*\{/g,
    (m, cond) => `while ((__tick(), (${cond}))) { __tick(); `
  );

  // for (init; cond; step) {
  code = code.replace(
    /for\s*\(([^;]*);([^;]*);([^\)]*)\)\s*\{/g,
    (m, init, cond, step) => `for (${init}; (__tick(), (${cond})); ${step}) { __tick(); `
  );

  // for (;;){ ... } ‚Äì condless forms
  code = code.replace(/for\s*\(\s*;\s*;\s*\)\s*\{/g, 'for (;;){ __tick(); ');

  return prelude + "\n" + code;
}


  // --- Studentencode uitvoeren met ondersteuning voor ask() ---
window.runStudentCode = function(studentCode) {
  
  let transformed = studentCode.replace(/ask\s*\(/g, 'await ask(');

  // Bescherming voor infinite loops: 
  transformed = applyLoopGuard(transformed, {
    maxIters: 200000,  // tweak if needed
    maxMs:    2000     // tweak if needed
  });

  
  const wrapper = `
    return (async function __student_main__() {
      ${transformed}
    })();
  `;
  return new Function('ask', 'console', wrapper)(window.ask, window.console);
};
  
// --- 3. Koppel de Run-knop aan runStudentCode (ipv new Function) ---
document.getElementById('run-code').onclick = async function() {
  // ‚ñº NIEUW: poging registreren + timer pauzeren terwijl code runt
  // (Timer start vanzelf opnieuw zodra de leerling weer typt in de editor.)
  if (isDirty && typeof incPogingen === 'function') incPogingen();   
  if (typeof stopWerkTimer === 'function') stopWerkTimer(); 
  if (typeof updateMetricsUI === 'function') updateMetricsUI(); 

  clearConsole();
  capturedOutput = "";

  try {

    if (window.resetTurtle) window.resetTurtle();
    if (window.clearCanvas) window.clearCanvas();


    const code = editor.getValue();
    const key = `jsprog-${currentChapterIdx}-${currentExerciseIdx}`;
    localStorage.setItem(key, code);
    isDirty = false;
    showSavedToast();


    await runStudentCode(code);

  } catch (e) {

    let uitleg = translateError(e.message);
    appendToConsole("Fout: " + uitleg + "\n(Origineel: " + e.message + ")");
  } finally {

    if (typeof updateMetricsUI === 'function') updateMetricsUI();


    const isCorrect = evaluateExercise();
    const evalKey = `jsprog-eval-${currentChapterIdx}-${currentExerciseIdx}`;
    if (isCorrect === true) {
      localStorage.setItem(evalKey, "success");
    } else if (isCorrect === false) {
      localStorage.setItem(evalKey, "fail");
    } else {
      localStorage.removeItem(evalKey); 
    }
    renderExerciseProgress();
    showEvalFeedback(isCorrect);
  }
};



</script>
  
</body>
</html>
